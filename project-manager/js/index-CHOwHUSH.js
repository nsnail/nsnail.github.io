import{m as e,_ as t}from"./index-Bx7rElEd.js";import{g as s}from"./element-plus-CoQd9HEf.js";import{aj as i,o as l,c as a,a as o,S as r,O as p,K as c,J as d,E as n,M as u,Q as m,P as f,F as h,G as g}from"./@vue-_BCsYqm-.js";import"./@element-plus-DpD46RjY.js";import"./crypto-js-BfYQ37JU.js";import"./axios-DMXdiZgf.js";import"./vue-router-DP39kmEB.js";import"./nprogress-BX4rmQ7W.js";import"./vuex-CNGLPxA3.js";import"./json-bigint-D0bu8vFr.js";import"./bignumber.js-iDjSUVmj.js";import"./vue-i18n-DbMEmpqT.js";import"./@intlify-CZIS8eQd.js";import"./vue3-json-viewer-B-aZDOpp.js";import"./ace-builds-D9YH2WY7.js";import"./vue3-ace-editor-ubj-WOyx.js";import"./resize-observer-polyfill-CzGuHLZU.js";import"./sortablejs-BALiOaUQ.js";import"./vkbeautify-DEVEMlla.js";import"./lodash-es-DCh--ulG.js";import"./@vueuse-DKZ1O7gq.js";import"./@sxzz-CpAfbxx4.js";import"./@ctrl-D2oWfImC.js";import"./dayjs-Cud5yAXI.js";import"./async-validator-BTKOuuO-.js";import"./memoize-one-Ds0C_khL.js";import"./normalize-wheel-es-Vn5vHDCm.js";import"./@floating-ui-DT7V1Oc1.js";const j={apiObj:e.sys_file.upload,filename:"file",successCode:"succeed",maxSize:10,parseData:function(e){return{code:e.code,src:e.data,msg:e.msg}},apiObjFile:e.sys_file.upload,maxSizeFile:10},y={props:{modelValue:{type:String,default:""},height:{type:Number,default:10},width:{type:Number,default:10},title:{type:String,default:""},icon:{type:String,default:"el-icon-plus"},action:{type:String,default:""},apiObj:{type:Object,default:()=>{}},name:{type:String,default:j.filename},data:{type:Object,default:()=>{}},accept:{type:String,default:"image/gif, image/jpeg, image/png"},maxSize:{type:Number,default:j.maxSizeFile},limit:{type:Number,default:1},autoUpload:{type:Boolean,default:!0},showFileList:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},round:{type:Boolean,default:!1},onSuccess:{type:Function,default:()=>!0},cropper:{type:Boolean,default:!1},compress:{type:Number,default:1},aspectRatio:{type:Number,default:NaN}},components:{},data(){return{value:"",file:null,style:{width:this.width+"rem",height:this.height+"rem"},cropperDialogVisible:!1,cropperFile:null}},watch:{modelValue(e){this.value=e,this.newFile(e)},value(e){this.$emit("update:modelValue",e)}},mounted(){this.value=this.modelValue,this.newFile(this.modelValue)},methods:{newFile(e){this.file=e?{status:"success",url:e}:null},cropperSave(){this.$refs.cropper.getCropFile((e=>{e.uid=this.cropperFile.uid,this.cropperFile.raw=e,this.file=this.cropperFile,this.file.tempFile=URL.createObjectURL(this.file.raw),this.$refs.uploader.submit()}),this.cropperFile.name,this.cropperFile.type),this.cropperDialogVisible=!1},cropperClosed(){URL.revokeObjectURL(this.cropperFile.tempCropperFile),delete this.cropperFile.tempCropperFile},handleRemove(){this.clearFiles()},clearFiles(){URL.revokeObjectURL(this.file.tempFile),this.value="",this.file=null,this.$nextTick((()=>{this.$refs.uploader.clearFiles()}))},change(e,t){if(t.length>1&&t.splice(0,1),this.cropper&&"ready"===e.status){return["image/gif","image/jpeg","image/png"].includes(e.raw.type)?(this.cropperFile=e,this.cropperFile.tempCropperFile=URL.createObjectURL(e.raw),this.cropperDialogVisible=!0,!1):(this.$notify.warning({title:"上传文件警告",message:"选择的文件非图像类文件"}),!1)}this.file=e,"ready"===e.status&&(e.tempFile=URL.createObjectURL(e.raw))},before(e){if(!this.accept.replace(/\s/g,"").split(",").includes(e.type))return this.$notify.warning({title:"上传文件警告",message:"选择的文件非图像类文件"}),this.clearFiles(),!1;return e.size/1024/1024<this.maxSize?void 0:(this.$message.warning(`上传文件大小不能超过 ${this.maxSize}MB!`),this.clearFiles(),!1)},handleExceed(e){const t=e[0];t.uid=s(),this.$refs.uploader.handleStart(t)},success(e,t){URL.revokeObjectURL(t.tempFile),delete t.tempFile;const s=this.onSuccess(e,t);if(void 0!==s&&!1===s)return this.$nextTick((()=>{this.file=null,this.value=""})),!1;const i=j.parseData(e);t.url=i.src,this.value=t.url},error(e){this.$nextTick((()=>{this.clearFiles()})),this.$notify.error({title:"上传文件未成功",message:e})},request(e){let t=j.apiObj;this.apiObj&&(t=this.apiObj);const s=new FormData;s.append(e.filename,e.file);for(const i in e.data)s.append(i,e.data[i]);t.post(s,{onUploadProgress:t=>{const s=parseInt(t.loaded/t.total*100|0,10);e.onProgress({percent:s})}}).then((t=>{const s=j.parseData(t);s.code===j.successCode?e.onSuccess(t):e.onError(s.msg||"未知错误")})).catch((t=>{e.onError(t)}))}}},b={key:0,class:"sc-upload__uploading"},v={class:"sc-upload__progress"},F={key:1,class:"sc-upload__img"},w={key:0,class:"sc-upload__img-actions"},_={class:"el-upload--picture-card"},x={class:"file-empty"},k={key:0},S={style:{display:"none !important"}};const R=t(y,[["render",function(e,t,s,j,y,R){const C=i("el-progress"),U=i("el-image"),V=i("el-icon-delete"),$=i("el-icon"),L=i("el-upload"),O=i("el-input"),z=i("scCropper"),D=i("el-button"),N=i("el-dialog");return l(),a("div",{class:h([{"sc-upload-round":s.round},"sc-upload"]),style:g(y.style)},[y.file&&"success"!==y.file.status?(l(),a("div",b,[o("div",v,[r(C,{percentage:y.file.percentage,"stroke-width":16,"text-inside":!0},null,8,["percentage"])]),r(U,{src:y.file.tempFile,class:"image",fit:"cover"},null,8,["src"])])):p("",!0),y.file&&"success"===y.file.status?(l(),a("div",F,[r(U,{"preview-src-list":[y.file.url],src:y.file.url,"z-index":9999,"append-to-body":"",class:"image",fit:"cover","hide-on-click-modal":""},{placeholder:c((()=>t[4]||(t[4]=[o("div",{class:"sc-upload__img-slot"},"Loading...",-1)]))),_:1},8,["preview-src-list","src"]),s.disabled?p("",!0):(l(),a("div",w,[o("span",{onClick:t[0]||(t[0]=e=>R.handleRemove()),class:"del"},[r($,null,{default:c((()=>[r(V)])),_:1})])]))])):p("",!0),y.file?p("",!0):(l(),d(L,{key:2,accept:s.accept,action:s.action,"auto-upload":!s.cropper&&s.autoUpload,"before-upload":R.before,data:s.data,disabled:s.disabled,"http-request":R.request,limit:1,name:s.name,"on-change":R.change,"on-error":R.error,"on-exceed":R.handleExceed,"on-success":R.success,"show-file-list":s.showFileList,class:"uploader",ref:"uploader"},{default:c((()=>[n(e.$slots,"default",{},(()=>[o("div",_,[o("div",x,[r($,null,{default:c((()=>[(l(),d(u(s.icon)))])),_:1}),s.title?(l(),a("h4",k,m(s.title),1)):p("",!0)])])]),!0)])),_:3},8,["accept","action","auto-upload","before-upload","data","disabled","http-request","name","on-change","on-error","on-exceed","on-success","show-file-list"])),o("span",S,[r(O,{modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=e=>y.value=e)},null,8,["modelValue"])]),r(N,{modelValue:y.cropperDialogVisible,"onUpdate:modelValue":t[3]||(t[3]=e=>y.cropperDialogVisible=e),title:e.$t("剪裁"),width:580,onClosed:R.cropperClosed,"destroy-on-close":"",draggable:""},{footer:c((()=>[r(D,{onClick:t[2]||(t[2]=e=>y.cropperDialogVisible=!1)},{default:c((()=>[f(m(e.$t("取消")),1)])),_:1}),r(D,{onClick:R.cropperSave,type:"primary"},{default:c((()=>[f(m(e.$t("确定")),1)])),_:1},8,["onClick"])])),default:c((()=>[r(z,{aspectRatio:s.aspectRatio,compress:s.compress,src:y.cropperFile.tempCropperFile,ref:"cropper"},null,8,["aspectRatio","compress","src"])])),_:1},8,["modelValue","title","onClosed"])],6)}],["__scopeId","data-v-e297b6ff"]]);export{R as default};
