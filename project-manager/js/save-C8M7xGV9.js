import{_ as e}from"./index-Bx7rElEd.js";import{aj as l,at as t,o as a,J as o,K as d,S as r,P as s,Q as i,L as m,O as u}from"./@vue-_BCsYqm-.js";import"./element-plus-CoQd9HEf.js";import"./lodash-es-DCh--ulG.js";import"./@vueuse-DKZ1O7gq.js";import"./@element-plus-DpD46RjY.js";import"./@sxzz-CpAfbxx4.js";import"./@ctrl-D2oWfImC.js";import"./dayjs-Cud5yAXI.js";import"./async-validator-BTKOuuO-.js";import"./memoize-one-Ds0C_khL.js";import"./normalize-wheel-es-Vn5vHDCm.js";import"./@floating-ui-DT7V1Oc1.js";import"./crypto-js-BfYQ37JU.js";import"./axios-DMXdiZgf.js";import"./vue-router-DP39kmEB.js";import"./nprogress-BX4rmQ7W.js";import"./vuex-CNGLPxA3.js";import"./json-bigint-D0bu8vFr.js";import"./bignumber.js-iDjSUVmj.js";import"./vue-i18n-DbMEmpqT.js";import"./@intlify-CZIS8eQd.js";import"./vue3-json-viewer-B-aZDOpp.js";import"./ace-builds-D9YH2WY7.js";import"./vue3-ace-editor-ubj-WOyx.js";import"./resize-observer-polyfill-CzGuHLZU.js";import"./sortablejs-BALiOaUQ.js";import"./vkbeautify-DEVEMlla.js";const p=e({components:{},data(){return{col2Width:18,esData:null,form:{},loading:!0,mode:"add",rules:{},titleMap:{add:this.$t("新增作业记录"),edit:this.$t("编辑作业记录"),view:this.$t("查看作业记录")},visible:!1}},emits:["success","closed","mounted"],methods:{async open(e){var l;if(this.visible=!0,this.loading=!0,this.mode=e.mode,null==(l=e.row)?void 0:l.id){let l=await this.$API.sys_job.getRecord.post({id:e.row.id});Object.assign(this.form,l.data);const t=/"traceId":"(.+?)"/.exec(this.form.responseBody);t&&t[1]&&(l=await this.$API.adm_tools.queryEsLog.post({query:{bool:{must:[{range:{"@timestamp":{gt:new Date(this.form.createdTime).getTime()-36e5,lt:new Date(this.form.createdTime).getTime()+36e5}}},{match_phrase:{log_source:"NetAdmin.SysComponent.Host.Utils.RequestLogger"}},{match_phrase:{log_message:t[1]}}]}},size:1e3,sort:[{"@timestamp":"desc"}]}),this.esData=l.data.hits.hits[0]._source,this.col2Width=9)}return this.loading=!1,this}},mounted(){this.$emit("mounted")}},[["render",function(e,p,n,h,f,b){var c;const _=l("el-input"),y=l("el-form-item"),g=l("el-col"),j=l("JsonViewer"),v=l("el-row"),V=l("el-tab-pane"),$=l("el-tabs"),w=l("el-form"),A=l("el-button"),P=l("scDialog"),T=t("loading");return a(),o(P,{modelValue:f.visible,"onUpdate:modelValue":p[13]||(p[13]=e=>f.visible=e),title:`${f.titleMap[f.mode]}：${(null==(c=f.form)?void 0:c.id)??"..."}`,onClosed:p[14]||(p[14]=l=>e.$emit("closed")),"destroy-on-close":"","full-screen":""},{footer:d((()=>[r(A,{onClick:p[12]||(p[12]=e=>f.visible=!1)},{default:d((()=>[s(i(e.$t("取消")),1)])),_:1})])),default:d((()=>[m((a(),o(w,{disabled:"view"===f.mode,model:f.form,rules:f.rules,"label-position":"right","label-width":"15rem",ref:"dialogForm"},{default:d((()=>[r($,{"tab-position":"top"},{default:d((()=>[r(V,{label:e.$t("基本信息")},{default:d((()=>[r(v,{gutter:10},{default:d((()=>[r(g,{lg:6},{default:d((()=>[r(y,{label:e.$t("唯一编码"),prop:"id"},{default:d((()=>[r(_,{modelValue:f.form.id,"onUpdate:modelValue":p[0]||(p[0]=e=>f.form.id=e),clearable:""},null,8,["modelValue"])])),_:1},8,["label"]),r(y,{label:e.$t("执行耗时（毫秒）"),prop:"duration"},{default:d((()=>[r(_,{modelValue:f.form.duration,"onUpdate:modelValue":p[1]||(p[1]=e=>f.form.duration=e),clearable:""},null,8,["modelValue"])])),_:1},8,["label"]),r(y,{label:e.$t("请求方法"),prop:"httpMethod"},{default:d((()=>[r(_,{modelValue:f.form.httpMethod,"onUpdate:modelValue":p[2]||(p[2]=e=>f.form.httpMethod=e),clearable:""},null,8,["modelValue"])])),_:1},8,["label"]),r(y,{label:e.$t("响应状态码"),prop:"httpStatusCode"},{default:d((()=>[r(_,{modelValue:f.form.httpStatusCode,"onUpdate:modelValue":p[3]||(p[3]=e=>f.form.httpStatusCode=e),clearable:""},null,8,["modelValue"])])),_:1},8,["label"]),r(y,{label:e.$t("作业编号"),prop:"jobId"},{default:d((()=>[r(_,{modelValue:f.form.jobId,"onUpdate:modelValue":p[4]||(p[4]=e=>f.form.jobId=e),clearable:""},null,8,["modelValue"])])),_:1},8,["label"]),r(y,{label:e.$t("请求的网络地址"),prop:"requestUrl"},{default:d((()=>[r(_,{modelValue:f.form.requestUrl,"onUpdate:modelValue":p[5]||(p[5]=e=>f.form.requestUrl=e),clearable:"",type:"textarea"},null,8,["modelValue"])])),_:1},8,["label"]),r(y,{label:e.$t("执行时间编号"),prop:"timeId"},{default:d((()=>[r(_,{modelValue:f.form.timeId,"onUpdate:modelValue":p[6]||(p[6]=e=>f.form.timeId=e),clearable:""},null,8,["modelValue"])])),_:1},8,["label"]),r(y,{label:e.$t("创建时间"),prop:"createdTime"},{default:d((()=>[r(_,{modelValue:f.form.createdTime,"onUpdate:modelValue":p[7]||(p[7]=e=>f.form.createdTime=e),clearable:""},null,8,["modelValue"])])),_:1},8,["label"])])),_:1}),r(g,{lg:f.col2Width},{default:d((()=>[f.form.requestBody?(a(),o(y,{key:0,label:e.$t("请求体"),prop:"requestBody"},{default:d((()=>["view"===f.mode?(a(),o(j,{key:0,"expand-depth":5,theme:this.$TOOL.data.get("APP_SET_DARK")||this.$CONFIG.APP_SET_DARK?"dark":"light",value:JSON.parse(f.form.requestBody),class:"w100p children-nopadding",copyable:"",expanded:"",sort:""},null,8,["theme","value"])):(a(),o(_,{key:1,modelValue:f.form.requestBody,"onUpdate:modelValue":p[8]||(p[8]=e=>f.form.requestBody=e),clearable:"",rows:"5",type:"textarea"},null,8,["modelValue"]))])),_:1},8,["label"])):u("",!0),f.form.responseBody?(a(),o(y,{key:1,label:e.$t("响应体"),prop:"responseBody"},{default:d((()=>["view"===f.mode?(a(),o(j,{key:0,"expand-depth":5,theme:this.$TOOL.data.get("APP_SET_DARK")||this.$CONFIG.APP_SET_DARK?"dark":"light",value:JSON.parse(f.form.responseBody),class:"w100p children-nopadding",copyable:"",expanded:"",sort:""},null,8,["theme","value"])):(a(),o(_,{key:1,modelValue:f.form.responseBody,"onUpdate:modelValue":p[9]||(p[9]=e=>f.form.responseBody=e),clearable:"",rows:"5",type:"textarea"},null,8,["modelValue"]))])),_:1},8,["label"])):u("",!0),f.form.requestHeader?(a(),o(y,{key:2,label:e.$t("请求头"),prop:"requestHeader"},{default:d((()=>["view"===f.mode?(a(),o(j,{key:0,"expand-depth":1,theme:this.$TOOL.data.get("APP_SET_DARK")||this.$CONFIG.APP_SET_DARK?"dark":"light",value:JSON.parse(f.form.requestHeader),class:"w100p children-nopadding",copyable:"",expanded:"",sort:""},null,8,["theme","value"])):(a(),o(_,{key:1,modelValue:f.form.requestHeader,"onUpdate:modelValue":p[10]||(p[10]=e=>f.form.requestHeader=e),clearable:"",rows:"5",type:"textarea"},null,8,["modelValue"]))])),_:1},8,["label"])):u("",!0),f.form.responseHeader?(a(),o(y,{key:3,label:e.$t("响应头"),prop:"responseHeader"},{default:d((()=>["view"===f.mode?(a(),o(j,{key:0,"expand-depth":1,theme:this.$TOOL.data.get("APP_SET_DARK")||this.$CONFIG.APP_SET_DARK?"dark":"light",value:JSON.parse(f.form.responseHeader),class:"w100p children-nopadding",copyable:"",expanded:"",sort:""},null,8,["theme","value"])):(a(),o(_,{key:1,modelValue:f.form.responseHeader,"onUpdate:modelValue":p[11]||(p[11]=e=>f.form.responseHeader=e),clearable:"",rows:"5",type:"textarea"},null,8,["modelValue"]))])),_:1},8,["label"])):u("",!0)])),_:1},8,["lg"]),this.esData?(a(),o(g,{key:0,lg:9},{default:d((()=>["view"===f.mode?(a(),o(j,{key:0,"expand-depth":1,theme:this.$TOOL.data.get("APP_SET_DARK")||this.$CONFIG.APP_SET_DARK?"dark":"light",value:this.esData,class:"children-nopadding",copyable:"",expanded:"",sort:""},null,8,["theme","value"])):u("",!0)])),_:1})):u("",!0)])),_:1})])),_:1},8,["label"]),"view"===f.mode?(a(),o(V,{key:0,label:e.$t("原始数据")},{default:d((()=>[r(j,{"expand-depth":5,theme:this.$TOOL.data.get("APP_SET_DARK")||this.$CONFIG.APP_SET_DARK?"dark":"light",value:f.form,copyable:"",expanded:"",sort:""},null,8,["theme","value"])])),_:1},8,["label"])):u("",!0)])),_:1})])),_:1},8,["disabled","model","rules"])),[[T,f.loading]])])),_:1},8,["modelValue","title"])}]]);export{p as default};
