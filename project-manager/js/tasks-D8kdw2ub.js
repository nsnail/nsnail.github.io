const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./save-BTE1FOvS.js","./index-C3Re8InM.js","./@vue-_BCsYqm-.js","./element-plus-CoQd9HEf.js","./lodash-es-DCh--ulG.js","./@vueuse-DKZ1O7gq.js","./@element-plus-DpD46RjY.js","./@sxzz-CpAfbxx4.js","./@ctrl-D2oWfImC.js","./dayjs-Cud5yAXI.js","./async-validator-BTKOuuO-.js","./memoize-one-Ds0C_khL.js","./normalize-wheel-es-Vn5vHDCm.js","./@floating-ui-DT7V1Oc1.js","../css/element-plus-B3lJtvYm.css","./crypto-js-BfYQ37JU.js","./axios-DMXdiZgf.js","./vue-router-CJBOlWwF.js","./nprogress-BX4rmQ7W.js","../css/nprogress-BgDCIyLK.css","./vuex-CNGLPxA3.js","./json-bigint-D0bu8vFr.js","./bignumber.js-iDjSUVmj.js","./vue-i18n-DbMEmpqT.js","./@intlify-CZIS8eQd.js","./vue3-json-viewer-B-aZDOpp.js","../css/vue3-json-viewer-ByH33Jf7.css","./ace-builds-D9YH2WY7.js","./vue3-ace-editor-ubj-WOyx.js","./resize-observer-polyfill-CzGuHLZU.js","./sortablejs-BALiOaUQ.js","./vkbeautify-DEVEMlla.js","../css/index-CllpfDYF.css","./save-CqV3EM3-.js"])))=>i.map(i=>d[i]);
import{_ as e,a as t}from"./index-C3Re8InM.js";import{aj as a,o,c as s,a as i,S as l,K as r,J as d,M as n,O as u,Q as p,E as c,P as m,at as j,L as b,R as v,a7 as g,F as f,aE as h}from"./@vue-_BCsYqm-.js";import"./element-plus-CoQd9HEf.js";import"./lodash-es-DCh--ulG.js";import"./@vueuse-DKZ1O7gq.js";import"./@element-plus-DpD46RjY.js";import"./@sxzz-CpAfbxx4.js";import"./@ctrl-D2oWfImC.js";import"./dayjs-Cud5yAXI.js";import"./async-validator-BTKOuuO-.js";import"./memoize-one-Ds0C_khL.js";import"./normalize-wheel-es-Vn5vHDCm.js";import"./@floating-ui-DT7V1Oc1.js";import"./crypto-js-BfYQ37JU.js";import"./axios-DMXdiZgf.js";import"./vue-router-CJBOlWwF.js";import"./nprogress-BX4rmQ7W.js";import"./vuex-CNGLPxA3.js";import"./json-bigint-D0bu8vFr.js";import"./bignumber.js-iDjSUVmj.js";import"./vue-i18n-DbMEmpqT.js";import"./@intlify-CZIS8eQd.js";import"./vue3-json-viewer-B-aZDOpp.js";import"./ace-builds-D9YH2WY7.js";import"./vue3-ace-editor-ubj-WOyx.js";import"./resize-observer-polyfill-CzGuHLZU.js";import"./sortablejs-BALiOaUQ.js";import"./vkbeautify-DEVEMlla.js";const y={class:"sc-page-header"},_={key:0,class:"sc-page-header__icon"},S={class:"sc-page-header__title"},$={key:0},C={key:1,class:"sc-page-header__main"};const T=e({props:{title:{type:String,required:!0,default:""},description:{type:String,default:""},icon:{type:String,default:""}}},[["render",function(e,t,j,b,v,g){const f=a("el-icon");return o(),s("div",y,[j.icon?(o(),s("div",_,[i("span",null,[l(f,null,{default:r((()=>[(o(),d(n(j.icon)))])),_:1})])])):u("",!0),i("div",S,[i("h2",null,p(j.title),1),j.description||e.$slots.default?(o(),s("p",$,[c(e.$slots,"default",{},(()=>[m(p(j.description),1)]),!0)])):u("",!0)]),e.$slots.main?(o(),s("div",C,[c(e.$slots,"main",{},void 0,!0)])):u("",!0)])}],["__scopeId","data-v-6b68bef2"]]),w=h((()=>t((()=>import("./save-BTE1FOvS.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]),import.meta.url))),k=h((()=>t((()=>import("./save-CqV3EM3-.js")),__vite__mapDeps([33,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]),import.meta.url))),D={key:0},E={class:"user-bar-jobs-item-body"},O={class:"jobIcon"},x={class:"jobMain"},I={class:"title"},R=["title"],J={class:"bottom"},z={class:"status"},L={class:"user-bar-jobs-item-body"},P={class:"jobIcon"},F={class:"jobMain"},M={class:"title"},V=["title"],A={class:"bottom"},q={class:"status"};const K=e({computed:{failJobViewTime(){return this.$TOOL.data.get("APP_SET_FAIL_JOB_VIEW_TIME")??this.$TOOL.dateFormat(new Date,"yyyy-MM-dd")}},components:{scPageHeader:T,jobSaveDialog:w,jobRecordSaveDialog:k},data:()=>({dialog:{},loading:!1,jobs:[],jobsCnt:0,failJobs:[]}),emits:["closed"],inject:["reload"],methods:{async getData(){this.loading=!0;const e=await Promise.all([this.$API.sys_job.pagedQuery.post({prop:"nextExecTime",order:"ascending",dynamicFilter:{field:"enabled",value:!0,operator:"eq"},pageSize:10}),this.$API.sys_job.pagedQueryRecord.post({dynamicFilter:{filters:[{logic:"or",filters:[{field:"httpStatusCode",operator:"range",value:"300,399"},{field:"httpStatusCode",operator:"range",value:"400,499"},{field:"httpStatusCode",operator:"range",value:"500,599"},{field:"httpStatusCode",operator:"range",value:"900,999"}]}],field:"createdTime",operator:"greaterThan",value:this.failJobViewTime},pageSize:10})]);this.jobs=e[0].data.rows,this.jobsCnt=e[0].data.total,this.failJobs=e[1].data.rows,this.loading=!1},refresh(){this.getData()}},mounted(){this.getData()},props:{fail:{type:Number,default:0}},watch:{}},[["render",function(e,t,n,c,h,y){const _=a("el-button"),S=a("el-badge"),$=a("el-header"),C=a("el-empty"),T=a("el-tag"),w=a("el-card"),k=a("el-col"),K=a("el-row"),N=a("el-main"),Q=a("el-container"),B=a("jobSaveDialog"),H=a("jobRecordSaveDialog"),U=j("time"),W=j("loading");return o(),s(v,null,[b((o(),d(Q,null,{default:r((()=>[l($,{class:"flex",style:{"justify-content":"space-evenly",height:"unset"}},{default:r((()=>[h.failJobs?(o(),s("div",D,[l(S,{hidden:0===n.fail,value:`${e.$TOOL.time.getFormatTime(new Date(y.failJobViewTime).getTime())} 至今 ${n.fail}个`},{default:r((()=>[l(_,{onClick:t[0]||(t[0]=()=>{this.$router.push({path:"/sys/job",query:{view:"fail"}}),this.$emit("closed")}),plain:"",type:"danger"},{default:r((()=>[m(p(e.$t("异常日志")),1)])),_:1})])),_:1},8,["hidden","value"])])):u("",!0),l(_,{onClick:y.refresh,circle:"",icon:"el-icon-refresh"},null,8,["onClick"]),i("div",null,[l(S,{hidden:0===h.jobsCnt,value:h.jobsCnt,type:"primary"},{default:r((()=>[l(_,{onClick:t[1]||(t[1]=()=>{this.$router.push({path:"/sys/job"}),this.$emit("closed")})},{default:r((()=>[m(p(e.$t("作业管理")),1)])),_:1})])),_:1},8,["hidden","value"])])])),_:1}),l(N,null,{default:r((()=>[0===h.jobs.length?(o(),d(C,{key:0,"image-size":120},{description:r((()=>[i("h2",null,p(e.$t("没有正在执行的作业")),1)])),_:1})):u("",!0),l(K,{gutter:10},{default:r((()=>[l(k,{lg:12},{default:r((()=>[h.failJobs?(o(!0),s(v,{key:1},g(h.failJobs,(a=>(o(),d(w,{class:f("user-bar-jobs-item alert"),key:a.job.id,onClick:e=>h.dialog.jobRecordSave={mode:"view",row:{id:a.id}},shadow:"hover"},{default:r((()=>[i("div",E,[i("div",O,p(a.httpStatusCode.toUpperCase().slice(0,2)),1),i("div",x,[i("div",I,[i("h2",null,p(a.job.jobName),1),i("p",null,[m(p(e.$t("出错时间：")),1),b(i("span",{title:a.createdTime},null,8,R),[[U,a.createdTime,void 0,{tip:!0}]])]),i("p",null,[t[8]||(t[8]=m(" 执行耗时：")),i("span",null,p(e.$TOOL.groupSeparator(a.duration))+" ms",1)])]),i("div",J,[i("div",z,[l(T,{type:"danger"},{default:r((()=>[m(p(a.responseBody),1)])),_:2},1024)])])])])])),_:2},1032,["onClick"])))),128)):(o(),d(C,{key:0},{description:r((()=>[i("p",null,p(e.$TOOL.time.getFormatTime(new Date(y.failJobViewTime).getTime())),1),t[6]||(t[6]=i("p",null,"至今",-1)),t[7]||(t[7]=i("p",null,"未发现新的异常作业",-1))])),_:1}))])),_:1}),l(k,{lg:12},{default:r((()=>[(o(!0),s(v,null,g(h.jobs,(a=>(o(),d(w,{class:f("user-bar-jobs-item "+("oK"===a.lastStatusCode?"":"alert")),key:a.id,onClick:e=>h.dialog.jobSave={mode:"view",row:{id:a.id},tabId:"record"},shadow:"hover"},{default:r((()=>{var s;return[i("div",L,[i("div",P,p(null==(s=a.lastStatusCode)?void 0:s.toUpperCase().slice(0,2)),1),i("div",F,[i("div",M,[i("h2",null,p(a.jobName),1),i("p",null,[m(p(e.$t("上次执行：")),1),b(i("span",{title:a.lastExecTime},null,8,V),[[U,a.lastExecTime,void 0,{tip:!0}]])]),i("p",null,[t[9]||(t[9]=m(" 下次执行：")),i("span",null,p(a.nextExecTime),1)])]),i("div",A,[i("div",q,["running"===a.status?(o(),d(T,{key:0,type:"warning"},{default:r((()=>[m(p(e.$t("执行中")),1)])),_:1})):u("",!0),"idle"===a.status?(o(),d(T,{key:1,type:"oK"===a.lastStatusCode?"primary":"danger"},{default:r((()=>[m(p(e.$t("空闲")),1)])),_:2},1032,["type"])):u("",!0)])])])])]})),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})])),_:1})])),_:1})),[[W,h.loading]]),h.dialog.jobSave?(o(),d(B,{key:0,onClosed:t[2]||(t[2]=e=>h.dialog.jobSave=null),onMounted:t[3]||(t[3]=t=>e.$refs.jobSaveDialog.open(h.dialog.jobSave)),ref:"jobSaveDialog"},null,512)):u("",!0),h.dialog.jobRecordSave?(o(),d(H,{key:1,onClosed:t[4]||(t[4]=e=>h.dialog.jobRecordSave=null),onMounted:t[5]||(t[5]=t=>e.$refs.jobRecordSaveDialog.open(h.dialog.jobRecordSave)),ref:"jobRecordSaveDialog"},null,512)):u("",!0)],64)}],["__scopeId","data-v-eff78f3b"]]);export{K as default};
