import{_ as s}from"./index-Bx7rElEd.js";import{L as e,o as t,c as i,J as a,K as o,S as r,a as l,R as n,a7 as d,F as m,Q as g,aj as c,at as u}from"./@vue-_BCsYqm-.js";import"./element-plus-CoQd9HEf.js";import"./lodash-es-DCh--ulG.js";import"./@vueuse-DKZ1O7gq.js";import"./@element-plus-DpD46RjY.js";import"./@sxzz-CpAfbxx4.js";import"./@ctrl-D2oWfImC.js";import"./dayjs-Cud5yAXI.js";import"./async-validator-BTKOuuO-.js";import"./memoize-one-Ds0C_khL.js";import"./normalize-wheel-es-Vn5vHDCm.js";import"./@floating-ui-DT7V1Oc1.js";import"./crypto-js-BfYQ37JU.js";import"./axios-DMXdiZgf.js";import"./vue-router-DP39kmEB.js";import"./nprogress-BX4rmQ7W.js";import"./vuex-CNGLPxA3.js";import"./json-bigint-D0bu8vFr.js";import"./bignumber.js-iDjSUVmj.js";import"./vue-i18n-DbMEmpqT.js";import"./@intlify-CZIS8eQd.js";import"./vue3-json-viewer-B-aZDOpp.js";import"./ace-builds-D9YH2WY7.js";import"./vue3-ace-editor-ubj-WOyx.js";import"./resize-observer-polyfill-CzGuHLZU.js";import"./sortablejs-BALiOaUQ.js";import"./vkbeautify-DEVEMlla.js";const p={class:"right-panel"},h={class:"msg-collapse"},y={key:0},j={key:1},f=["title"];const L=s({components:{},data:()=>({msgList:[],currMsgId:null,loading:!0,page:1,delLoading:!1,msgLoading:!1,readLoading:!1}),watch:{},computed:{},mounted(){},async created(){await this.load()},methods:{async load(){const s=await this.$API.sys_sitemsg.pagedQueryMine.post({page:this.page++});s.data.rows&&(this.msgList=this.msgList.concat(s.data.rows)),this.loading=!1},async change(s){if(!s)return;this.msgLoading=!0;const e=await this.$API.sys_sitemsg.getMine.post({id:s});this.msgLoading=!1;try{this.$refs[`msg-content-${s}`][0].attachShadow({mode:"open"}).innerHTML=e.data.content}catch{}await this.$API.sys_sitemsg.setSiteMsgStatus.post({siteMsgId:s,userSiteMsgStatus:"read"})},async batchRead(){this.readLoading=!0;try{for(const s of this.msgList)await this.$API.sys_sitemsg.setSiteMsgStatus.post({siteMsgId:s.id,userSiteMsgStatus:"read"}),s.myFlags.userSiteMsgStatus="read"}catch{}this.readLoading=!1,this.$message.success(this.$t("本页消息已标记为已读"))},async batchDel(){this.delLoading=!0;try{await Promise.all(this.msgList.map((s=>this.$API.sys_sitemsg.setSiteMsgStatus.post({siteMsgId:s.id,userSiteMsgStatus:"deleted"}))))}catch{}this.delLoading=!1,this.$message.success(this.$t("本页消息已清空")),this.msgList=[],this.page=1,this.loading=!0,await this.load()}}},[["render",function(s,L,v,S,b,M){const _=c("el-button"),w=c("el-popconfirm"),I=c("el-header"),$=c("el-avatar"),A=c("el-badge"),k=c("el-collapse-item"),C=c("el-collapse"),F=c("el-main"),z=c("el-container"),T=c("el-empty"),x=u("loading"),P=u("time"),D=u("infinite-scroll");return e((t(),i("div",null,[b.msgList.length>0?(t(),a(z,{key:0,class:"nopadding"},{default:o((()=>[r(I,{style:{border:"none"}},{default:o((()=>[l("div",p,[e(r(_,{disabled:b.readLoading,onClick:M.batchRead,icon:"el-icon-message",plain:"",type:"success"},null,8,["disabled","onClick"]),[[x,b.readLoading]]),r(w,{title:"确定清空本页消息吗？",onConfirm:M.batchDel,width:"15rem"},{reference:o((()=>[e(r(_,{disabled:b.delLoading,icon:"el-icon-delete",plain:"",type:"danger"},null,8,["disabled"]),[[x,b.delLoading]])])),_:1},8,["onConfirm"])])])),_:1}),r(F,null,{default:o((()=>[l("div",h,[e((t(),a(C,{modelValue:b.currMsgId,"onUpdate:modelValue":L[0]||(L[0]=s=>b.currMsgId=s),onChange:M.change,accordion:"","infinite-scroll-distance":"200"},{default:o((()=>[(t(!0),i(n,null,d(b.msgList,((n,d)=>(t(),a(k,{key:d,name:n.id},{title:o((()=>[l("div",{class:m("msg-title "+("read"===n.myFlags.userSiteMsgStatus?"msg-wrapper-read":""))},[l("div",null,[0===n.myFlags.userSiteMsgStatus?(t(),a(A,{key:0,"is-dot":"",type:"primary"},{default:o((()=>[r($,{size:40,src:n.sender.avatar??s.$CONFIG.DEFAULT_AVATAR(n.sender.userName)},null,8,["src"])])),_:2},1024)):(t(),a($,{key:1,size:40,src:n.sender.avatar??s.$CONFIG.DEFAULT_AVATAR(n.sender.userName)},null,8,["src"]))]),l("div",null,[l("h2",null,g(n.title),1),n.id!==b.currMsgId?(t(),i("p",y,g(n.summary),1)):(t(),i("p",j,g(n.createdTime),1))]),l("div",null,[l("p",null,g(n.sender.userName),1),e(l("p",{title:n.createdTime},null,8,f),[[P,n.createdTime,void 0,{tip:!0}]])])],2)])),default:o((()=>[l("div",{ref_for:!0,ref:`msg-content-${n.id}`},null,512)])),_:2},1032,["name"])))),128))])),_:1},8,["modelValue","onChange"])),[[D,M.load],[x,b.msgLoading]])])])),_:1})])),_:1})):(t(),a(T,{key:1}))])),[[x,b.loading]])}],["__scopeId","data-v-06a0657a"]]);export{L as default};
