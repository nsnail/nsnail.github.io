const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./save-C8M7xGV9.js","./index-Bx7rElEd.js","./@vue-_BCsYqm-.js","./element-plus-CoQd9HEf.js","./lodash-es-DCh--ulG.js","./@vueuse-DKZ1O7gq.js","./@element-plus-DpD46RjY.js","./@sxzz-CpAfbxx4.js","./@ctrl-D2oWfImC.js","./dayjs-Cud5yAXI.js","./async-validator-BTKOuuO-.js","./memoize-one-Ds0C_khL.js","./normalize-wheel-es-Vn5vHDCm.js","./@floating-ui-DT7V1Oc1.js","../css/element-plus-B3lJtvYm.css","./crypto-js-BfYQ37JU.js","./axios-DMXdiZgf.js","./vue-router-DP39kmEB.js","./nprogress-BX4rmQ7W.js","../css/nprogress-BgDCIyLK.css","./vuex-CNGLPxA3.js","./json-bigint-D0bu8vFr.js","./bignumber.js-iDjSUVmj.js","./vue-i18n-DbMEmpqT.js","./@intlify-CZIS8eQd.js","./vue3-json-viewer-B-aZDOpp.js","../css/vue3-json-viewer-ByH33Jf7.css","./ace-builds-D9YH2WY7.js","./vue3-ace-editor-ubj-WOyx.js","./resize-observer-polyfill-CzGuHLZU.js","./sortablejs-BALiOaUQ.js","./vkbeautify-DEVEMlla.js","../css/index-CllpfDYF.css","./save-Wq7fgWab.js"])))=>i.map(i=>d[i]);
import{_ as t,e,n as s,d as a,a as o}from"./index-Bx7rElEd.js";import{aj as l,at as r,o as i,c as d,S as u,K as p,L as n,J as h,a as c,P as y,Q as m,O as f,R as b,aE as j}from"./@vue-_BCsYqm-.js";import"./element-plus-CoQd9HEf.js";import"./lodash-es-DCh--ulG.js";import"./@vueuse-DKZ1O7gq.js";import"./@element-plus-DpD46RjY.js";import"./@sxzz-CpAfbxx4.js";import"./@ctrl-D2oWfImC.js";import"./dayjs-Cud5yAXI.js";import"./async-validator-BTKOuuO-.js";import"./memoize-one-Ds0C_khL.js";import"./normalize-wheel-es-Vn5vHDCm.js";import"./@floating-ui-DT7V1Oc1.js";import"./crypto-js-BfYQ37JU.js";import"./axios-DMXdiZgf.js";import"./vue-router-DP39kmEB.js";import"./nprogress-BX4rmQ7W.js";import"./vuex-CNGLPxA3.js";import"./json-bigint-D0bu8vFr.js";import"./bignumber.js-iDjSUVmj.js";import"./vue-i18n-DbMEmpqT.js";import"./@intlify-CZIS8eQd.js";import"./vue3-json-viewer-B-aZDOpp.js";import"./ace-builds-D9YH2WY7.js";import"./vue3-ace-editor-ubj-WOyx.js";import"./resize-observer-polyfill-CzGuHLZU.js";import"./sortablejs-BALiOaUQ.js";import"./vkbeautify-DEVEMlla.js";const v=j((()=>o((()=>import("./save-C8M7xGV9.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]),import.meta.url))),g=j((()=>o((()=>import("./save-Wq7fgWab.js")),__vite__mapDeps([33,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]),import.meta.url))),C={class:"left-panel"};const $=t({components:{naIndicator:e,saveDialog:v,jobDialog:g},computed:{naColOperation:()=>s,table:()=>a},created(){this.statusCodes&&this.query.dynamicFilter.filters.push({logic:"or",filters:this.statusCodes.map((t=>({field:"httpStatusCode",operator:"range",value:t})))}),this.jobId&&this.query.dynamicFilter.filters.push({field:"jobId",operator:"eq",value:this.jobId})},data(){return{statistics:{total:"...",rate:"..."},dialog:{},loading:!1,query:{dynamicFilter:{filters:[{field:"createdTime",operator:"dateRange",value:[this.$TOOL.dateFormat(new Date,"yyyy-MM-dd"),this.$TOOL.dateFormat(new Date,"yyyy-MM-dd")]}]},filter:{}}}},inject:["reload"],methods:{filterChange(t){Object.entries(t).forEach((([t,e])=>{this.$refs.search.form.dy[t]="true"===e||"false"!==e&&e})),this.$refs.search.search()},async getStatistics(){var t,e,s,a;this.statistics.total=null==(t=this.$refs.table)?void 0:t.total;const o=await Promise.all([this.$API.sys_job.recordCountBy.post({dynamicFilter:{filters:this.query.dynamicFilter.filters},requiredFields:["HttpStatusCode"]})]);this.statistics.httpStatusCode=o[0].data;try{let t=((null==(a=null==(s=null==(e=o[0].data)?void 0:e.filter((t=>0===t.key.httpStatusCode.indexOf("2"))))?void 0:s.map((t=>t.value)))?void 0:a.reduce(((t,e)=>t+e)))??0)/this.statistics.total*100;t>100&&(t=100),this.statistics.rate=t.toFixed(2)}catch{this.statistics.rate=0}},jobClick(t){this.dialog.job={mode:"view",row:{id:t.id}}},onReset(){this.jobId&&(this.$refs.search.selectInputKey="jobId")},async onSearch(t){if(Array.isArray(t.dy.createdTime)&&this.query.dynamicFilter.filters.push({field:"createdTime",operator:"dateRange",value:t.dy.createdTime.map((t=>t.replace(/ 00:00:00$/,"")))}),"string"==typeof t.dy.httpMethod&&""!==t.dy.httpMethod.trim()&&this.query.dynamicFilter.filters.push({field:"httpMethod",operator:"eq",value:t.dy.httpMethod}),Array.isArray(t.dy.httpStatusCode)&&0!==t.dy.httpStatusCode.length){const e=[];for(const s of t.dy.httpStatusCode)e.push({field:"httpStatusCode",operator:"range",value:s});this.query.dynamicFilter.filters.push({logic:"or",filters:e})}"string"==typeof t.dy.id&&""!==t.dy.id.trim()&&this.query.dynamicFilter.filters.push({field:"id",operator:"eq",value:t.dy.id}),"number"==typeof t.dy.jobId&&0!==t.dy.jobId&&this.query.dynamicFilter.filters.push({field:"jobId",operator:"eq",value:t.dy.jobId}),"string"==typeof t.dy.httpStatusCode&&""!==t.dy.httpStatusCode.trim()&&this.query.dynamicFilter.filters.push({field:"httpStatusCode",operator:"eq",value:t.dy.httpStatusCode}),"string"==typeof t.dy.httpMethod&&""!==t.dy.httpMethod.trim()&&this.query.dynamicFilter.filters.push({field:"httpMethod",operator:"eq",value:t.dy.httpMethod}),await this.$refs.table.upData()}},async mounted(){this.jobId&&(this.$refs.search.selectInputKey="jobId",this.$refs.search.form.dy.jobId=this.jobId,this.$refs.search.keeps.push({field:"jobId",value:this.jobId,type:"dy"})),this.statusCodes&&(this.$refs.search.form.dy.httpStatusCode=this.statusCodes,this.$refs.search.keeps.push({field:"httpStatusCode",value:this.statusCodes,type:"dy"})),this.$refs.search.form.dy.createdTime=[`${this.$TOOL.dateFormat(new Date,"yyyy-MM-dd")} 00:00:00`,`${this.$TOOL.dateFormat(new Date,"yyyy-MM-dd")} 00:00:00`],this.$refs.search.keeps.push({field:"createdTime",value:this.$refs.search.form.dy.createdTime,type:"dy"})},props:["statusCodes","jobId"],watch:{}},[["render",function(t,e,s,a,o,j){const v=l("scStatistic"),g=l("el-card"),$=l("el-col"),S=l("el-row"),w=l("el-header"),I=l("scSelectFilter"),_=l("na-search"),M=l("naColId"),O=l("na-indicator"),F=l("el-table-column"),q=l("el-link"),x=l("naColOperation"),D=l("scTable"),k=l("el-main"),T=l("el-container"),L=l("save-dialog"),A=l("job-dialog"),R=r("loading");return i(),d(b,null,[u(T,null,{default:p((()=>[n((i(),h(w,{class:"el-header-statistics"},{default:p((()=>[u(S,{gutter:15},{default:p((()=>[u($,{span:12},{default:p((()=>[u(g,{shadow:"never"},{default:p((()=>[u(v,{value:o.statistics.total,"group-separator":"",title:"总数"},null,8,["value"])])),_:1})])),_:1}),u($,{span:12},{default:p((()=>[u(g,{shadow:"never"},{default:p((()=>[u(v,{value:o.statistics.rate,suffix:"%",title:"成功率"},null,8,["value"])])),_:1})])),_:1})])),_:1})])),_:1})),[[R,"..."===o.statistics.total]]),u(w,{class:"el-header-select-filter"},{default:p((()=>{var e;return[u(I,{data:[{title:t.$t("响应状态码"),key:"httpStatusCode",options:[{label:t.$t("全部"),value:""},...(null==(e=this.statistics.httpStatusCode)?void 0:e.map((t=>({value:t.key.httpStatusCode,label:t.key.httpStatusCode,badge:t.value}))))??[]]}],"label-width":9,onOnChange:j.filterChange,ref:"selectFilter"},null,8,["data","onOnChange"])]})),_:1}),u(w,null,{default:p((()=>[c("div",C,[u(_,{controls:[{type:"select",field:["dy","httpMethod"],options:Object.entries(this.$GLOBAL.enums.httpMethods).map((t=>({value:t[0],label:t[1][1]}))),placeholder:t.$t("请求方式"),style:"width:15rem"},{multiple:!0,type:"select",field:["dy","httpStatusCode"],options:[{label:"20x",value:"200,299"},{label:"30x",value:"300,399"},{label:"40x",value:"400,499"},{label:"50x",value:"500,599"},{label:"90x",value:"900,999"}],placeholder:t.$t("状态码"),style:"width:20rem"},{type:"select-input",field:["dy",[{label:"唯一编码",key:"id"},{label:"作业编号",key:"jobId"}]],placeholder:"匹配内容",style:"width:25rem",selectStyle:"width:8rem"}],vue:this,onReset:j.onReset,onSearch:j.onSearch,dateFormat:"YYYY-MM-DD HH:mm:ss",dateType:"datetimerange",dateValueFormat:"YYYY-MM-DD HH:mm:ss",ref:"search"},null,8,["controls","onReset","onSearch"])]),e[6]||(e[6]=c("div",{class:"right-panel"},null,-1))])),_:1}),u(k,{class:"nopadding"},{default:p((()=>[u(D,{"cell-style":t=>{if("duration"===t.column.property&&t.row.duration>1e3)return{color:"var(--el-color-danger)"}},"context-menus":["id","duration","httpMethod","requestUrl","httpStatusCode","createdTime","jobId","responseBody"],"default-sort":{prop:"id",order:"descending"},"export-api":t.$API.sys_job.exportRecord,params:o.query,"query-api":t.$API.sys_job.pagedQueryRecord,vue:this,onDataChange:j.getStatistics,ref:"table","remote-filter":"","remote-sort":"","row-key":"id",stripe:""},{default:p((()=>[u(M,{label:t.$t("唯一编码"),prop:"id",sortable:"custom",width:"170"},null,8,["label"]),u(F,{label:t.$t("响应状态码"),prop:"httpStatusCode",sortable:"custom",width:"200"},{default:p((({row:t})=>[c("p",null,[u(O,{data:t,options:Object.entries(this.$GLOBAL.enums.httpMethods).map((t=>({value:t[0],text:`${t[1][1].toString().toUpperCase()}`,type:t[1][2],pulse:"true"===t[1][3]}))),prop:"httpMethod"},null,8,["data","options"])]),c("p",null,[u(O,{data:t,options:Object.entries(this.$GLOBAL.enums.httpStatusCodes).map((t=>({value:t[0],text:`${t[1][1]}`,type:t[1][2],pulse:"true"===t[1][3]}))),prop:"httpStatusCode"},null,8,["data","options"])])])),_:1},8,["label"]),u(F,{formatter:e=>`${t.$TOOL.groupSeparator(e.duration.toFixed(0))} ms`,label:t.$t("执行耗时"),align:"right",prop:"duration",sortable:"custom",width:"100"},null,8,["formatter","label"]),u(F,{label:t.$t("作业信息"),"min-width":"200",prop:"jobId","show-overflow-tooltip":"",sortable:"custom"},{default:p((({row:t})=>[c("p",null,[u(q,{onClick:e=>j.jobClick(t.job)},{default:p((()=>[y(m(t.job.jobName),1)])),_:2},1032,["onClick"])]),c("p",null,m(t.requestUrl),1)])),_:1},8,["label"]),u(F,{label:t.$t("响应体"),"min-width":"300",prop:"responseBody","show-overflow-tooltip":"",sortable:"custom"},null,8,["label"]),u(x,{buttons:[j.naColOperation.buttons[0]],vue:this,width:"50"},null,8,["buttons"])])),_:1},8,["cell-style","export-api","params","query-api","onDataChange"])])),_:1})])),_:1}),o.dialog.save?(i(),h(L,{key:0,onClosed:e[0]||(e[0]=t=>o.dialog.save=null),onMounted:e[1]||(e[1]=e=>t.$refs.saveDialog.open(o.dialog.save)),onSuccess:e[2]||(e[2]=(e,s)=>j.table.handleUpdate(t.$refs.table,e,s)),ref:"saveDialog"},null,512)):f("",!0),o.dialog.job?(i(),h(A,{key:1,onClosed:e[3]||(e[3]=t=>o.dialog.job=null),onMounted:e[4]||(e[4]=e=>t.$refs.jobDialog.open(o.dialog.job)),onSuccess:e[5]||(e[5]=(e,s)=>j.table.handleUpdate(t.$refs.table,e,s)),ref:"jobDialog"},null,512)):f("",!0)],64)}]]);export{$ as default};
