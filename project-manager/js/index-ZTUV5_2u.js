import e from"./save-CzDCwS0r.js";import{aj as t,at as s,o as i,J as a,K as o,L as l,S as n,a as r,Q as d,Y as c}from"./@vue-_BCsYqm-.js";import{_ as m}from"./index-C3Re8InM.js";import"./element-plus-CoQd9HEf.js";import"./lodash-es-DCh--ulG.js";import"./@vueuse-DKZ1O7gq.js";import"./@element-plus-DpD46RjY.js";import"./@sxzz-CpAfbxx4.js";import"./@ctrl-D2oWfImC.js";import"./dayjs-Cud5yAXI.js";import"./async-validator-BTKOuuO-.js";import"./memoize-one-Ds0C_khL.js";import"./normalize-wheel-es-Vn5vHDCm.js";import"./@floating-ui-DT7V1Oc1.js";import"./crypto-js-BfYQ37JU.js";import"./axios-DMXdiZgf.js";import"./vue-router-CJBOlWwF.js";import"./nprogress-BX4rmQ7W.js";import"./vuex-CNGLPxA3.js";import"./json-bigint-D0bu8vFr.js";import"./bignumber.js-iDjSUVmj.js";import"./vue-i18n-DbMEmpqT.js";import"./@intlify-CZIS8eQd.js";import"./vue3-json-viewer-B-aZDOpp.js";import"./ace-builds-D9YH2WY7.js";import"./vue3-ace-editor-ubj-WOyx.js";import"./resize-observer-polyfill-CzGuHLZU.js";import"./sortablejs-BALiOaUQ.js";import"./vkbeautify-DEVEMlla.js";const p={class:"custom-tree-node"},u={class:"btn"};const h=m({components:{save:e},data:()=>({loading:!1,treeList:[],filterText:""}),inject:["reload"],methods:{async getTree(){this.loading=!0;const e=await this.$API.sys_menu.query.post();this.loading=!1,this.treeList=e.data},treeClick(e,t){this.$refs.save.setData(e,1===t.level?0:t.parent.data.id),this.$refs.main.$el.scrollTop=0},treeFilterNode(e,t){if(!e)return!0;return-1!==t.meta.title.indexOf(e)},async copy(e){const t=Object.assign({},e,{id:0,meta:Object.assign({},e.meta,{title:e.meta.title+"-copy"}),name:e.name+"-copy"});this.loading=!0,await this.$API.sys_menu.create.post(t),this.loading=!1,this.reload()},async add(e,t){const s={parentId:t?t.id:0,name:Math.random().toString(),path:Math.random().toString(),meta:{title:"未命名",type:"menu"}};this.loading=!0;const i=await this.$API.sys_menu.create.post(s);this.loading=!1,Object.assign(s,i.data),this.$refs.tree.append(s,e),this.$refs.tree.setCurrentKey(s.id),this.$refs.save.setData(s,e?e.data.id:"")},async del(e,t){this.loading=!0;try{const e=await this.$API.sys_menu.delete.post({id:t.id});this.$message.success(this.$t("删除 {count} 项",{count:e.data}))}catch{}await this.handleSuccess(),this.loading=!1},async batchDel(){const e=this.$refs.tree.getCheckedNodes();if(0===e.length)return this.$message.warning("请选择需要删除的项"),!1;try{await this.$confirm("确认删除已选择的菜单吗？","提示",{type:"warning",confirmButtonText:"删除",confirmButtonClass:"el-button--danger"})}catch{return!1}this.loading=!0;try{await this.$API.sys_menu.bulkDelete.post({items:e.map((e=>({id:e.id})))}),e.forEach((e=>{this.$refs.tree.getNode(e).isCurrent&&this.$refs.save.setData({}),this.$refs.tree.remove(e)}))}catch{}this.loading=!1},async handleSuccess(){this.reload()}},mounted(){this.getTree()},watch:{filterText(e){this.$refs.tree.filter(e)}}},[["render",function(e,m,h,f,j,g){const y=t("el-input"),b=t("el-header"),v=t("el-button"),$=t("el-popconfirm"),k=t("el-button-group"),C=t("el-tree"),_=t("el-main"),w=t("el-footer"),x=t("el-container"),z=t("el-aside"),D=t("save"),S=s("loading");return i(),a(x,null,{default:o((()=>[l((i(),a(z,{width:"30rem"},{default:o((()=>[n(x,null,{default:o((()=>[n(b,null,{default:o((()=>[n(y,{modelValue:j.filterText,"onUpdate:modelValue":m[0]||(m[0]=e=>j.filterText=e),placeholder:e.$t("输入关键字进行过滤"),clearable:""},null,8,["modelValue","placeholder"])])),_:1}),n(_,{class:"nopadding"},{default:o((()=>[n(C,{"check-strictly":!0,data:j.treeList,"default-expand-all":!0,"expand-on-click-node":!1,"filter-node-method":g.treeFilterNode,props:{label:e=>e.meta.title+" - "+e.sort},onNodeClick:g.treeClick,draggable:"","highlight-current":"","node-key":"id",ref:"tree","show-checkbox":""},{default:o((({node:e,data:t})=>[r("div",p,[r("span",null,d(e.label),1),r("span",u,[n(k,{size:"small"},{default:o((()=>[n(v,{onClick:c((s=>g.add(e,t)),["stop"]),icon:"el-icon-plus"},null,8,["onClick"]),n(v,{onClick:c((e=>g.copy(t)),["stop"]),icon:"el-icon-copy-document"},null,8,["onClick"]),n($,{title:this.$t("确定删除 {item} 吗？",{item:t.meta.title}),onConfirm:s=>g.del(e,t),width:"20rem"},{reference:o((()=>[n(v,{onClick:c((()=>{}),["stop"]),icon:"el-icon-delete"})])),_:2},1032,["title","onConfirm"])])),_:2},1024)])])])),_:1},8,["data","filter-node-method","props","onNodeClick"])])),_:1}),n(w,null,{default:o((()=>[n(v,{onClick:m[1]||(m[1]=e=>g.add()),icon:"el-icon-plus",size:"small",type:"primary"}),n(v,{onClick:g.batchDel,icon:"el-icon-delete",plain:"",size:"small",type:"danger"},null,8,["onClick"])])),_:1})])),_:1})])),_:1})),[[S,j.loading]]),n(x,null,{default:o((()=>[n(_,{class:"main",ref:"main"},{default:o((()=>[n(D,{tree:j.treeList,onSuccess:g.handleSuccess,ref:"save"},null,8,["tree","onSuccess"])])),_:1},512)])),_:1})])),_:1})}],["__scopeId","data-v-baf31a55"]]);export{h as default};
