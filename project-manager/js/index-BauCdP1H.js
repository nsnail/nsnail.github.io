const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./save-D43o2h2S.js","./index-Bx7rElEd.js","./@vue-_BCsYqm-.js","./element-plus-CoQd9HEf.js","./lodash-es-DCh--ulG.js","./@vueuse-DKZ1O7gq.js","./@element-plus-DpD46RjY.js","./@sxzz-CpAfbxx4.js","./@ctrl-D2oWfImC.js","./dayjs-Cud5yAXI.js","./async-validator-BTKOuuO-.js","./memoize-one-Ds0C_khL.js","./normalize-wheel-es-Vn5vHDCm.js","./@floating-ui-DT7V1Oc1.js","../css/element-plus-B3lJtvYm.css","./crypto-js-BfYQ37JU.js","./axios-DMXdiZgf.js","./vue-router-DP39kmEB.js","./nprogress-BX4rmQ7W.js","../css/nprogress-BgDCIyLK.css","./vuex-CNGLPxA3.js","./json-bigint-D0bu8vFr.js","./bignumber.js-iDjSUVmj.js","./vue-i18n-DbMEmpqT.js","./@intlify-CZIS8eQd.js","./vue3-json-viewer-B-aZDOpp.js","../css/vue3-json-viewer-ByH33Jf7.css","./ace-builds-D9YH2WY7.js","./vue3-ace-editor-ubj-WOyx.js","./resize-observer-polyfill-CzGuHLZU.js","./sortablejs-BALiOaUQ.js","./vkbeautify-DEVEMlla.js","../css/index-CllpfDYF.css","./save-Di_hlFhy.js","./index-_Q7MkIXC.js","../css/index-BSZl419t.css","./index-BRujge10.js","../css/index-6NguD0yg.css"])))=>i.map(i=>d[i]);
import{_ as e,d as t,a as l}from"./index-Bx7rElEd.js";import{aj as a,at as s,o as i,c as r,S as o,K as d,L as n,J as p,a as u,P as c,Q as h,T as m,O as f,R as y,aE as g}from"./@vue-_BCsYqm-.js";import"./element-plus-CoQd9HEf.js";import"./lodash-es-DCh--ulG.js";import"./@vueuse-DKZ1O7gq.js";import"./@element-plus-DpD46RjY.js";import"./@sxzz-CpAfbxx4.js";import"./@ctrl-D2oWfImC.js";import"./dayjs-Cud5yAXI.js";import"./async-validator-BTKOuuO-.js";import"./memoize-one-Ds0C_khL.js";import"./normalize-wheel-es-Vn5vHDCm.js";import"./@floating-ui-DT7V1Oc1.js";import"./crypto-js-BfYQ37JU.js";import"./axios-DMXdiZgf.js";import"./vue-router-DP39kmEB.js";import"./nprogress-BX4rmQ7W.js";import"./vuex-CNGLPxA3.js";import"./json-bigint-D0bu8vFr.js";import"./bignumber.js-iDjSUVmj.js";import"./vue-i18n-DbMEmpqT.js";import"./@intlify-CZIS8eQd.js";import"./vue3-json-viewer-B-aZDOpp.js";import"./ace-builds-D9YH2WY7.js";import"./vue3-ace-editor-ubj-WOyx.js";import"./resize-observer-polyfill-CzGuHLZU.js";import"./sortablejs-BALiOaUQ.js";import"./vkbeautify-DEVEMlla.js";const b=g((()=>l((()=>import("./save-D43o2h2S.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]),import.meta.url))),v=g((()=>l((()=>import("./save-Di_hlFhy.js")),__vite__mapDeps([33,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]),import.meta.url))),$=g((()=>l((()=>import("./index-Bx7rElEd.js").then((e=>e.s))),__vite__mapDeps([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]),import.meta.url))),_=g((()=>l((()=>import("./index-_Q7MkIXC.js")),__vite__mapDeps([34,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,35]),import.meta.url))),w=g((()=>l((()=>import("./index-BRujge10.js")),__vite__mapDeps([36,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,37]),import.meta.url))),j={class:"left-panel"},I={class:"right-panel"},k=["title"];const C=e({components:{naColAvatar:_,deptSaveDialog:v,roleSaveDialog:b,saveDialog:$,naColTags:w},computed:{table:()=>t},async created(){this.roleId&&(this.query.filter.roleId=this.roleId),this.deptId&&(this.query.filter.deptId=this.deptId);const e=await this.$API.sys_dept.query.post({});this.deptTree=[{id:0,name:"所有部门",children:e.data}]},data(){return{deptTree:null,statistics:{total:"..."},dialog:{},loading:!1,query:{dynamicFilter:{filters:[{field:"enabled",operator:"eq",value:!0}]},filter:{},keywords:this.keywords},selection:[]}},inject:["reload"],methods:{deptClick(e){this.$refs.search.form.filter.deptId=e.id,this.$refs.search.search()},async getStatistics(){var e;this.statistics.total=null==(e=this.$refs.table)?void 0:e.total;const t=await Promise.all([this.$API.sys_user.countBy.post({filter:this.query.filter,dynamicFilter:{filters:this.query.dynamicFilter.filters},requiredFields:["Enabled"]})]);this.statistics.enabled=t[0].data},async setEnabled(e){let t;try{await this.$confirm(this.$t("确定要 {operator} 选中的 {count} 项吗？",{operator:e?this.$t("启用"):this.$t("禁用"),count:this.selection.length}),this.$t("提示"),{type:"warning"}),t=this.$loading();const l=await Promise.all(this.selection.map((t=>this.$API.sys_user.setEnabled.post(Object.assign(t,{enabled:e})))));this.$message.success(this.$t("操作成功 {count}/{total} 项",{count:l.map((e=>e.data??0)).reduce(((e,t)=>e+t),0),total:this.selection.length}))}catch{}this.$refs.table.refresh(),null==t||t.close()},async changeSwitch(e,t){try{await this.$API.sys_user.setEnabled.post(t),this.$message.success(this.$t("操作成功"))}catch{}this.$refs.table.refresh()},filterChange(e){Object.entries(e).forEach((([e,t])=>{this.$refs.search.form.dy[e]="true"===t||"false"!==t&&t})),this.$refs.search.search()},onReset(){Object.entries(this.$refs.selectFilter.selected).forEach((([e,t])=>this.$refs.selectFilter.selected[e]=[""])),this.$refs.selectFilter.selected.enabled=[!0],this.$refs.tree.setCurrentKey(0)},async onSearch(e){Array.isArray(e.dy.createdTime)&&this.query.dynamicFilter.filters.push({field:"createdTime",operator:"dateRange",value:e.dy.createdTime.map((e=>e.replace(/ 00:00:00$/,"")))}),"boolean"==typeof e.dy.enabled&&this.query.dynamicFilter.filters.push({field:"enabled",operator:"eq",value:e.dy.enabled}),await this.$refs.table.upData()}},async mounted(){this.keywords&&(this.$refs.search.form.root.keywords=this.keywords,this.$refs.search.keeps.push({field:"keywords",value:this.keywords,type:"root"})),this.roleId&&(this.$refs.search.form.filter.roleId=this.roleId,this.$refs.search.keeps.push({field:"roleId",value:this.roleId,type:"filter"})),this.deptId&&(this.$refs.search.form.filter.deptId=this.deptId,this.$refs.search.keeps.push({field:"deptId",value:this.deptId,type:"filter"})),this.$refs.search.form.dy.enabled=!0,this.$refs.search.keeps.push({field:"enabled",value:!0,type:"dy"}),this.onReset()},props:["keywords","roleId","deptId"],watch:{}},[["render",function(e,t,l,g,b,v){const $=a("scStatistic"),_=a("el-card"),w=a("el-col"),C=a("el-row"),S=a("el-header"),T=a("scSelectFilter"),D=a("na-search"),E=a("el-button"),x=a("el-icon-arrow-down"),A=a("el-icon"),q=a("el-dropdown-item"),F=a("el-dropdown-menu"),P=a("el-dropdown"),O=a("el-tree"),R=a("el-table-column"),L=a("naColId"),V=a("naColAvatar"),Y=a("naColTags"),M=a("el-switch"),z=a("naColOperation"),H=a("scTable"),N=a("el-main"),U=a("el-container"),K=a("save-dialog"),Q=a("role-save-dialog"),B=a("dept-save-dialog"),J=s("loading"),Z=s("time");return i(),r(y,null,[o(U,null,{default:d((()=>[n((i(),p(S,{class:"el-header-statistics"},{default:d((()=>[o(C,{gutter:15},{default:d((()=>[o(w,{lg:24},{default:d((()=>[o(_,{shadow:"never"},{default:d((()=>[o($,{value:b.statistics.total,"group-separator":"",title:"总数"},null,8,["value"])])),_:1})])),_:1})])),_:1})])),_:1})),[[J,"..."===b.statistics.total]]),o(S,{class:"el-header-select-filter"},{default:d((()=>{var t,l,a,s;return[o(T,{data:[{title:e.$t("启用状态"),key:"enabled",options:[{label:e.$t("全部"),value:""},{label:e.$t("启用"),value:!0,badge:null==(l=null==(t=b.statistics.enabled)?void 0:t.find((e=>"True"===e.key.enabled)))?void 0:l.value},{label:e.$t("禁用"),value:!1,badge:null==(s=null==(a=b.statistics.enabled)?void 0:a.find((e=>"False"===e.key.enabled)))?void 0:s.value}]}],"label-width":10,onOnChange:v.filterChange,ref:"selectFilter"},null,8,["data","onOnChange"])]})),_:1}),o(S,null,{default:d((()=>[u("div",j,[o(D,{controls:[{type:"input",field:["root","keywords"],placeholder:e.$t("用户编号 / 用户名 / 手机号 / 邮箱 / 备注"),style:"width:25rem"},{type:"remote-select",field:["filter","roleId"],api:e.$API.sys_role.query,config:{props:{label:"name",value:"id"}},placeholder:e.$t("所属角色"),style:"width:15rem"}],vue:this,onReset:v.onReset,onSearch:v.onSearch,dateFormat:"YYYY-MM-DD HH:mm:ss",dateType:"datetimerange",dateValueFormat:"YYYY-MM-DD HH:mm:ss",ref:"search"},null,8,["controls","onReset","onSearch"])]),u("div",I,[o(E,{onClick:t[0]||(t[0]=e=>this.dialog.save={mode:"add"}),icon:"el-icon-plus",type:"primary"}),n(o(P,null,{dropdown:d((()=>[o(F,null,{default:d((()=>[o(q,{onClick:t[1]||(t[1]=e=>v.setEnabled(!0))},{default:d((()=>[c(h(e.$t("启用用户")),1)])),_:1}),o(q,{onClick:t[2]||(t[2]=e=>v.setEnabled(!1))},{default:d((()=>[c(h(e.$t("禁用用户")),1)])),_:1})])),_:1})])),default:d((()=>[o(E,{type:"primary"},{default:d((()=>[c(h(e.$t("批量操作"))+" ",1),o(A,null,{default:d((()=>[o(x)])),_:1})])),_:1})])),_:1},512),[[m,this.selection.length>0]])])])),_:1}),o(N,{class:"nopadding"},{default:d((()=>[o(C,{class:"h100p"},{default:d((()=>[o(w,{lg:4},{default:d((()=>[n(o(O,{data:b.deptTree,"default-expand-all":!0,"expand-on-click-node":!1,props:{label:e=>e.name},onNodeClick:v.deptClick,"highlight-current":"","node-key":"id",ref:"tree"},null,8,["data","props","onNodeClick"]),[[J,!b.deptTree]])])),_:1}),o(w,{lg:20},{default:d((()=>[o(H,{"context-menus":["id","userName","mobile","email","enabled","createdTime","lastLoginTime"],"context-opers":["view","edit"],"default-sort":{prop:"id",order:"descending"},"export-api":e.$API.sys_user.export,params:b.query,"query-api":e.$API.sys_user.pagedQuery,vue:this,onDataChange:v.getStatistics,onSelectionChange:t[5]||(t[5]=e=>{b.selection=e}),ref:"table","remote-filter":"","remote-sort":"","row-key":"id",stripe:""},{default:d((()=>[o(R,{type:"selection",width:"50"}),o(L,{label:e.$t("用户编号"),prop:"id",sortable:"custom",width:"170"},null,8,["label"]),o(V,{label:e.$t("用户名"),prop:"userName",width:"170"},null,8,["label"]),o(R,{label:e.$t("手机号 / 邮箱"),align:"right",prop:"mobile",sortable:"custom",width:"250"},{default:d((({row:e})=>[u("p",null,h(e.mobile),1),u("p",null,h(e.email),1)])),_:1},8,["label"]),o(Y,{label:e.$t("所属部门"),onClick:t[3]||(t[3]=e=>this.dialog.deptSave={row:e,mode:"view"}),field:"name",prop:"dept",width:"120"},null,8,["label"]),o(Y,{label:e.$t("所属角色"),onClick:t[4]||(t[4]=e=>this.dialog.roleSave={row:e,mode:"view"}),field:"name","min-width":"200",prop:"roles"},null,8,["label"]),o(R,{label:e.$t("最后登录"),align:"right",prop:"lastLoginTime",sortable:"custom",width:"120"},{default:d((({row:e})=>[n(u("span",{title:e.lastLoginTime},null,8,k),[[Z,e.lastLoginTime,void 0,{tip:!0}]])])),_:1},8,["label"]),o(R,{label:e.$t("启用"),align:"center",prop:"enabled",sortable:"custom",width:"100"},{default:d((({row:e})=>[o(M,{modelValue:e.enabled,"onUpdate:modelValue":t=>e.enabled=t,onChange:t=>v.changeSwitch(t,e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1},8,["label"]),o(z,{vue:this,width:"120"})])),_:1},8,["export-api","params","query-api","onDataChange"])])),_:1})])),_:1})])),_:1})])),_:1}),b.dialog.save?(i(),p(K,{key:0,onClosed:t[6]||(t[6]=e=>b.dialog.save=null),onMounted:t[7]||(t[7]=t=>e.$refs.saveDialog.open(b.dialog.save)),onSuccess:t[8]||(t[8]=(t,l)=>v.table.handleUpdate(e.$refs.table,t,l)),ref:"saveDialog"},null,512)):f("",!0),b.dialog.roleSave?(i(),p(Q,{key:1,onClosed:t[9]||(t[9]=e=>b.dialog.roleSave=null),onMounted:t[10]||(t[10]=t=>e.$refs.roleSaveDialog.open(b.dialog.roleSave)),ref:"roleSaveDialog"},null,512)):f("",!0),b.dialog.deptSave?(i(),p(B,{key:2,onClosed:t[11]||(t[11]=e=>b.dialog.deptSave=null),onMounted:t[12]||(t[12]=t=>e.$refs.deptSaveDialog.open(b.dialog.deptSave)),ref:"deptSaveDialog"},null,512)):f("",!0)],64)}],["__scopeId","data-v-bbdf16f9"]]);export{C as default};
