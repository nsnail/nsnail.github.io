import{_ as e}from"./index-C3Re8InM.js";import{aj as t,at as a,o as l,J as s,K as i,L as o,c as r,G as u,a as d,E as h,S as p,Q as n}from"./@vue-_BCsYqm-.js";import"./element-plus-CoQd9HEf.js";import"./lodash-es-DCh--ulG.js";import"./@vueuse-DKZ1O7gq.js";import"./@element-plus-DpD46RjY.js";import"./@sxzz-CpAfbxx4.js";import"./@ctrl-D2oWfImC.js";import"./dayjs-Cud5yAXI.js";import"./async-validator-BTKOuuO-.js";import"./memoize-one-Ds0C_khL.js";import"./normalize-wheel-es-Vn5vHDCm.js";import"./@floating-ui-DT7V1Oc1.js";import"./crypto-js-BfYQ37JU.js";import"./axios-DMXdiZgf.js";import"./vue-router-CJBOlWwF.js";import"./nprogress-BX4rmQ7W.js";import"./vuex-CNGLPxA3.js";import"./json-bigint-D0bu8vFr.js";import"./bignumber.js-iDjSUVmj.js";import"./vue-i18n-DbMEmpqT.js";import"./@intlify-CZIS8eQd.js";import"./vue3-json-viewer-B-aZDOpp.js";import"./ace-builds-D9YH2WY7.js";import"./vue3-ace-editor-ubj-WOyx.js";import"./resize-observer-polyfill-CzGuHLZU.js";import"./sortablejs-BALiOaUQ.js";import"./vkbeautify-DEVEMlla.js";const f=20,c=function(e){return{data:e.data,rows:e.data.rows,total:e.data.total,msg:e.message,code:e.code}},m={page:"page",pageSize:"pageSize",keyword:"keyword"},g={label:"label",value:"value"},b={props:{modelValue:null,queryApi:{type:Object,default:()=>{}},params:{type:Object,default:()=>{}},placeholder:{type:String},size:{type:String,default:"default"},clearable:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},filterable:{type:Boolean,default:!1},collapseTags:{type:Boolean,default:!1},collapseTagsTooltip:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},tableWidth:{type:Number,default:40},mode:{type:String,default:"popover"},props:{type:Object,default:()=>{}}},data:()=>({loading:!1,keyword:null,defaultValue:[],tableData:[],pageSize:f,total:0,currentPage:1,defaultProps:{label:g.label,value:g.value,page:m.page,pageSize:m.pageSize,keyword:m.keyword},formData:{}}),computed:{},watch:{modelValue:{handler(){this.defaultValue=this.modelValue,this.autoCurrentLabel()},deep:!0}},mounted(){this.defaultProps=Object.assign(this.defaultProps,this.props),this.defaultValue=this.modelValue,this.autoCurrentLabel()},methods:{visibleChange(e){e?(this.currentPage=1,this.keyword=null,this.formData={},this.getData()):this.autoCurrentLabel()},async getData(){this.loading=!0;const e={[this.defaultProps.page]:this.currentPage,[this.defaultProps.pageSize]:this.pageSize,[this.defaultProps.keyword]:this.keyword};Object.assign(e,this.params,this.formData);const t=await this.queryApi.post(e),a=c(t);this.tableData=a.rows??[],this.total=a.total,this.loading=!1,await this.$nextTick((()=>{if(this.multiple)this.defaultValue.forEach((e=>{const t=this.tableData.filter((t=>t[this.defaultProps.value]===e[this.defaultProps.value]));t.length>0&&this.$refs.table.toggleRowSelection(t[0],!0)}));else{const e=this.tableData.filter((e=>e[this.defaultProps.value]===(this.defaultValue??{})[this.defaultProps.value]));this.$refs.table.setCurrentRow(e[0])}this.$refs.table.setScrollTop(0)}))},formSubmit(){this.currentPage=1,this.keyword=null,this.getData()},reload(){this.getData()},autoCurrentLabel(){this.$nextTick((()=>{this.multiple?this.$refs.select.states.selected.forEach((e=>{e.currentLabel=e.value[this.defaultProps.label]})):this.$refs.select.states.selectedLabel=(this.defaultValue??{})[this.defaultProps.label]}))},select(e,t){e.length&&-1!==e.indexOf(t)?this.defaultValue.push(t):this.defaultValue.splice(this.defaultValue.findIndex((e=>e[this.defaultProps.value]===t[this.defaultProps.value])),1),this.autoCurrentLabel(),this.$emit("update:modelValue",this.defaultValue),this.$emit("change",this.defaultValue)},selectAll(e){e.length>0?e.forEach((e=>{this.defaultValue.find((t=>t[this.defaultProps.value]===e[this.defaultProps.value]))||this.defaultValue.push(e)})):this.tableData.forEach((e=>{this.defaultValue.find((t=>t[this.defaultProps.value]===e[this.defaultProps.value]))&&this.defaultValue.splice(this.defaultValue.findIndex((t=>t[this.defaultProps.value]===e[this.defaultProps.value])),1)})),this.autoCurrentLabel(),this.$emit("update:modelValue",this.defaultValue),this.$emit("change",this.defaultValue)},click(e){this.multiple||(this.defaultValue=e,this.$refs.select.blur(),this.autoCurrentLabel(),this.$emit("update:modelValue",this.defaultValue),this.$emit("change",this.defaultValue))},removeTag(e){const t=this.findRowByKey(e[this.defaultProps.value]);this.$refs.table.toggleRowSelection(t,!1),this.$emit("update:modelValue",this.defaultValue)},clear(){this.$emit("update:modelValue",this.defaultValue)},findRowByKey(e){return this.tableData.find((t=>t[this.defaultProps.value]===e))},filterMethod(e){if(!e)return this.keyword=null,!1;this.keyword=e,this.getData()},blur(){this.$refs.select.blur()},focus(){this.$refs.select.focus()}}},y={class:"scTable-select__header"},v={class:"scTable-select__page"};const j=e(b,[["render",function(e,f,c,m,g,b){const j=t("el-table-column"),V=t("el-table"),w=t("el-pagination"),P=t("el-select"),k=a("loading");return l(),s(P,{modelValue:g.defaultValue,"onUpdate:modelValue":f[1]||(f[1]=e=>g.defaultValue=e),clearable:c.clearable,"collapse-tags":c.collapseTags,"collapse-tags-tooltip":c.collapseTagsTooltip,disabled:c.disabled,"filter-method":b.filterMethod,filterable:c.filterable,multiple:c.multiple,placeholder:c.placeholder,size:c.size,onClear:b.clear,onRemoveTag:b.removeTag,onVisibleChange:b.visibleChange,ref:"select"},{empty:i((()=>[o((l(),r("div",{style:u({width:c.tableWidth+"rem"}),class:"scTable-select__table"},[d("div",y,[h(e.$slots,"header",{form:g.formData,submit:b.formSubmit},void 0,!0)]),p(V,{data:g.tableData,"highlight-current-row":!c.multiple,onRowClick:b.click,onSelect:b.select,onSelectAll:b.selectAll,"max-height":"30rem",ref:"table"},{default:i((()=>[c.multiple?(l(),s(j,{key:0,type:"selection",width:"45"})):(l(),s(j,{key:1,type:"index",width:"45"},{default:i((e=>[d("span",null,n(e.$index+(g.currentPage-1)*g.pageSize+1),1)])),_:1})),h(e.$slots,"default",{},void 0,!0)])),_:3},8,["data","highlight-current-row","onRowClick","onSelect","onSelectAll"]),d("div",v,[p(w,{currentPage:g.currentPage,"onUpdate:currentPage":f[0]||(f[0]=e=>g.currentPage=e),"page-size":g.pageSize,total:g.total,onCurrentChange:b.reload,background:"",layout:"prev, pager, next",small:""},null,8,["currentPage","page-size","total","onCurrentChange"])])],4)),[[k,g.loading]])])),_:3},8,["modelValue","clearable","collapse-tags","collapse-tags-tooltip","disabled","filter-method","filterable","multiple","placeholder","size","onClear","onRemoveTag","onVisibleChange"])}],["__scopeId","data-v-0d43d0bb"]]);export{j as default};
