const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./save-D43o2h2S.js","./index-Bx7rElEd.js","./@vue-_BCsYqm-.js","./element-plus-CoQd9HEf.js","./lodash-es-DCh--ulG.js","./@vueuse-DKZ1O7gq.js","./@element-plus-DpD46RjY.js","./@sxzz-CpAfbxx4.js","./@ctrl-D2oWfImC.js","./dayjs-Cud5yAXI.js","./async-validator-BTKOuuO-.js","./memoize-one-Ds0C_khL.js","./normalize-wheel-es-Vn5vHDCm.js","./@floating-ui-DT7V1Oc1.js","../css/element-plus-B3lJtvYm.css","./crypto-js-BfYQ37JU.js","./axios-DMXdiZgf.js","./vue-router-DP39kmEB.js","./nprogress-BX4rmQ7W.js","../css/nprogress-BgDCIyLK.css","./vuex-CNGLPxA3.js","./json-bigint-D0bu8vFr.js","./bignumber.js-iDjSUVmj.js","./vue-i18n-DbMEmpqT.js","./@intlify-CZIS8eQd.js","./vue3-json-viewer-B-aZDOpp.js","../css/vue3-json-viewer-ByH33Jf7.css","./ace-builds-D9YH2WY7.js","./vue3-ace-editor-ubj-WOyx.js","./resize-observer-polyfill-CzGuHLZU.js","./sortablejs-BALiOaUQ.js","./vkbeautify-DEVEMlla.js","../css/index-CllpfDYF.css"])))=>i.map(i=>d[i]);
import{_ as e,n as t,d as s,a}from"./index-Bx7rElEd.js";import{aj as l,at as o,o as i,c as r,S as n,K as d,L as u,J as c,a as p,P as h,Q as m,T as y,O as b,R as f,aE as g}from"./@vue-_BCsYqm-.js";import"./element-plus-CoQd9HEf.js";import"./lodash-es-DCh--ulG.js";import"./@vueuse-DKZ1O7gq.js";import"./@element-plus-DpD46RjY.js";import"./@sxzz-CpAfbxx4.js";import"./@ctrl-D2oWfImC.js";import"./dayjs-Cud5yAXI.js";import"./async-validator-BTKOuuO-.js";import"./memoize-one-Ds0C_khL.js";import"./normalize-wheel-es-Vn5vHDCm.js";import"./@floating-ui-DT7V1Oc1.js";import"./crypto-js-BfYQ37JU.js";import"./axios-DMXdiZgf.js";import"./vue-router-DP39kmEB.js";import"./nprogress-BX4rmQ7W.js";import"./vuex-CNGLPxA3.js";import"./json-bigint-D0bu8vFr.js";import"./bignumber.js-iDjSUVmj.js";import"./vue-i18n-DbMEmpqT.js";import"./@intlify-CZIS8eQd.js";import"./vue3-json-viewer-B-aZDOpp.js";import"./ace-builds-D9YH2WY7.js";import"./vue3-ace-editor-ubj-WOyx.js";import"./resize-observer-polyfill-CzGuHLZU.js";import"./sortablejs-BALiOaUQ.js";import"./vkbeautify-DEVEMlla.js";const v=g((()=>a((()=>import("./save-D43o2h2S.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]),import.meta.url))),$={class:"left-panel"},w={class:"right-panel"};const C=e({components:{saveDialog:v},computed:{naColOperation:()=>t,table:()=>s},created(){},data(){return{statistics:{total:"..."},dialog:{},loading:!1,query:{dynamicFilter:{filters:[{field:"enabled",operator:"eq",value:!0}]},filter:{},keywords:this.keywords},selection:[]}},inject:["reload"],methods:{async getStatistics(){var e;this.statistics.total=null==(e=this.$refs.table)?void 0:e.total;const t=await Promise.all([this.$API.sys_role.countBy.post({dynamicFilter:{filters:this.query.dynamicFilter.filters},requiredFields:["Enabled"]}),this.$API.sys_role.countBy.post({dynamicFilter:{filters:this.query.dynamicFilter.filters},requiredFields:["DisplayDashboard"]}),this.$API.sys_role.countBy.post({dynamicFilter:{filters:this.query.dynamicFilter.filters},requiredFields:["IgnorePermissionControl"]}),this.$API.sys_role.countBy.post({dynamicFilter:{filters:this.query.dynamicFilter.filters},requiredFields:["DataScope"]}),this.$API.sys_role.userCountBy.post({requiredFields:["RoleId"]})]);this.statistics.enabled=t[0].data,this.statistics.displayDashboard=t[1].data,this.statistics.ignorePermissionControl=t[2].data,this.statistics.dataScope=t[3].data,this.statistics.roleId=t[4].data},async copyRole(e){const t=this.$loading();await this.$API.sys_role.create.post(Object.assign({},e,{id:null,name:e.name+"-copy"})),this.$refs.table.refresh(),t.close()},async setEnabled(e){let t;try{await this.$confirm(this.$t("确定要 {operator} 选中的 {count} 项吗？",{operator:e?this.$t("启用"):this.$t("禁用"),count:this.selection.length}),this.$t("提示"),{type:"warning"}),t=this.$loading();const s=await Promise.all(this.selection.map((t=>this.$API.sys_role.setEnabled.post(Object.assign(t,{enabled:e})))));this.$message.success(this.$t("操作成功 {count}/{total} 项",{count:s.map((e=>e.data??0)).reduce(((e,t)=>e+t),0),total:this.selection.length}))}catch{}this.$refs.table.refresh(),null==t||t.close()},async changeIgnorePermissionControl(e,t){try{await this.$API.sys_role.setIgnorePermissionControl.post(t),this.$message.success(this.$t("操作成功"))}catch{}this.$refs.table.refresh()},async changeDisplayDashboard(e,t){try{await this.$API.sys_role.setDisplayDashboard.post(t),this.$message.success(this.$t("操作成功"))}catch{}this.$refs.table.refresh()},async changeEnabled(e,t){try{await this.$API.sys_role.setEnabled.post(t),this.$message.success(this.$t("操作成功"))}catch{}this.$refs.table.refresh()},filterChange(e){Object.entries(e).forEach((([e,t])=>{this.$refs.search.form.dy[e]="true"===t||"false"!==t&&t})),this.$refs.search.search()},onReset(){Object.entries(this.$refs.selectFilter.selected).forEach((([e,t])=>this.$refs.selectFilter.selected[e]=[""])),this.$refs.selectFilter.selected.enabled=[!0]},async onSearch(e){Array.isArray(e.dy.createdTime)&&this.query.dynamicFilter.filters.push({field:"createdTime",operator:"dateRange",value:e.dy.createdTime.map((e=>e.replace(/ 00:00:00$/,"")))}),"boolean"==typeof e.dy.ignorePermissionControl&&this.query.dynamicFilter.filters.push({field:"ignorePermissionControl",operator:"eq",value:e.dy.ignorePermissionControl}),"boolean"==typeof e.dy.enabled&&this.query.dynamicFilter.filters.push({field:"enabled",operator:"eq",value:e.dy.enabled}),"boolean"==typeof e.dy.displayDashboard&&this.query.dynamicFilter.filters.push({field:"displayDashboard",operator:"eq",value:e.dy.displayDashboard}),"string"==typeof e.dy.dataScope&&""!==e.dy.dataScope.trim()&&this.query.dynamicFilter.filters.push({field:"dataScope",operator:"eq",value:e.dy.dataScope}),await this.$refs.table.upData()}},async mounted(){this.keywords&&(this.$refs.search.form.root.keywords=this.keywords,this.$refs.search.keeps.push({field:"keywords",value:this.keywords,type:"root"})),this.$refs.search.form.dy.enabled=!0,this.$refs.search.keeps.push({field:"enabled",value:!0,type:"dy"}),this.onReset()},props:["keywords"],watch:{}},[["render",function(e,t,s,a,g,v){const C=l("scStatistic"),j=l("el-card"),_=l("el-col"),k=l("el-row"),D=l("el-header"),P=l("scSelectFilter"),F=l("na-search"),I=l("el-button"),S=l("naButtonBulkDel"),q=l("el-icon-arrow-down"),A=l("el-icon"),O=l("el-dropdown-item"),E=l("el-dropdown-menu"),V=l("el-dropdown"),x=l("el-table-column"),R=l("naColId"),T=l("el-link"),B=l("el-switch"),Y=l("naColIndicator"),L=l("naColOperation"),U=l("scTable"),z=l("el-main"),H=l("el-container"),M=l("save-dialog"),G=o("loading");return i(),r(f,null,[n(H,null,{default:d((()=>[u((i(),c(D,{class:"el-header-statistics"},{default:d((()=>[n(k,{gutter:15},{default:d((()=>[n(_,{lg:24},{default:d((()=>[n(j,{shadow:"never"},{default:d((()=>[n(C,{value:g.statistics.total,"group-separator":"",title:"总数"},null,8,["value"])])),_:1})])),_:1})])),_:1})])),_:1})),[[G,"..."===g.statistics.total]]),n(D,{class:"el-header-select-filter"},{default:d((()=>{var t,s,a,l,o,i,r,d,u,c,p,h;return[n(P,{data:[{title:e.$t("启用状态"),key:"enabled",options:[{label:e.$t("全部"),value:""},{label:e.$t("启用"),value:!0,badge:null==(s=null==(t=g.statistics.enabled)?void 0:t.find((e=>"True"===e.key.enabled)))?void 0:s.value},{label:e.$t("禁用"),value:!1,badge:null==(l=null==(a=g.statistics.enabled)?void 0:a.find((e=>"False"===e.key.enabled)))?void 0:l.value}]},{title:e.$t("无限权限"),key:"ignorePermissionControl",options:[{label:e.$t("全部"),value:""},{label:e.$t("是"),value:!0,badge:null==(i=null==(o=g.statistics.ignorePermissionControl)?void 0:o.find((e=>"True"===e.key.ignorePermissionControl)))?void 0:i.value},{label:e.$t("否"),value:!1,badge:null==(d=null==(r=g.statistics.ignorePermissionControl)?void 0:r.find((e=>"False"===e.key.ignorePermissionControl)))?void 0:d.value}]},{title:e.$t("显示仪表板"),key:"displayDashboard",options:[{label:e.$t("全部"),value:""},{label:e.$t("是"),value:!0,badge:null==(c=null==(u=g.statistics.displayDashboard)?void 0:u.find((e=>"True"===e.key.displayDashboard)))?void 0:c.value},{label:e.$t("否"),value:!1,badge:null==(h=null==(p=g.statistics.displayDashboard)?void 0:p.find((e=>"False"===e.key.displayDashboard)))?void 0:h.value}]},{title:e.$t("数据范围"),key:"dataScope",options:[{label:e.$t("全部"),value:""},...Object.entries(this.$GLOBAL.enums.dataScopes).map((e=>{var t,s;return{value:e[0],label:e[1][1],badge:null==(s=null==(t=this.statistics.dataScope)?void 0:t.find((t=>t.key.dataScope.toLowerCase()===e[0])))?void 0:s.value}}))]}],"label-width":15,onOnChange:v.filterChange,ref:"selectFilter"},null,8,["data","onOnChange"])]})),_:1}),n(D,null,{default:d((()=>[p("div",$,[n(F,{controls:[{type:"input",field:["root","keywords"],placeholder:e.$t("角色编号 / 角色名称 / 备注"),style:"width:20rem"}],vue:this,onReset:v.onReset,onSearch:v.onSearch,dateFormat:"YYYY-MM-DD HH:mm:ss",dateType:"datetimerange",dateValueFormat:"YYYY-MM-DD HH:mm:ss",ref:"search"},null,8,["controls","onReset","onSearch"])]),p("div",w,[n(I,{onClick:t[0]||(t[0]=e=>this.dialog.save={mode:"add"}),icon:"el-icon-plus",type:"primary"}),n(S,{api:e.$API.sys_role.bulkDelete,vue:this},null,8,["api"]),u(n(V,null,{dropdown:d((()=>[n(E,null,{default:d((()=>[n(O,{onClick:t[1]||(t[1]=e=>v.setEnabled(!0))},{default:d((()=>[h(m(e.$t("启用角色")),1)])),_:1}),n(O,{onClick:t[2]||(t[2]=e=>v.setEnabled(!1))},{default:d((()=>[h(m(e.$t("禁用角色")),1)])),_:1})])),_:1})])),default:d((()=>[n(I,{type:"primary"},{default:d((()=>[h(m(e.$t("批量操作"))+" ",1),n(A,null,{default:d((()=>[n(q)])),_:1})])),_:1})])),_:1},512),[[y,this.selection.length>0]])])])),_:1}),n(z,{class:"nopadding"},{default:d((()=>[n(U,{"context-menus":["id","name","sort","enabled","ignorePermissionControl","dataScope","displayDashboard","createdTime"],"default-sort":{prop:"sort",order:"descending"},"export-api":e.$API.sys_role.export,params:g.query,"query-api":e.$API.sys_role.pagedQuery,vue:this,onDataChange:v.getStatistics,onSelectionChange:t[3]||(t[3]=e=>{g.selection=e}),ref:"table","remote-filter":"","remote-sort":"","row-key":"id",stripe:""},{default:d((()=>[n(x,{type:"selection",width:"50"}),n(R,{label:e.$t("角色编号"),prop:"id",sortable:"custom",width:"170"},null,8,["label"]),n(x,{label:e.$t("角色名称"),"min-width":"150",prop:"name",sortable:"custom"},null,8,["label"]),n(x,{label:e.$t("用户数量"),align:"right",width:"100"},{default:d((({row:e})=>[n(T,{onClick:t=>g.dialog.save={mode:"view",row:e,tabId:"user"}},{default:d((()=>{var t,s;return[h(m((null==(s=null==(t=g.statistics.roleId)?void 0:t.find((t=>t.key.roleId===e.id.toString())))?void 0:s.value)??"0"),1)]})),_:2},1032,["onClick"])])),_:1},8,["label"]),n(x,{label:e.$t("排序"),align:"right",prop:"sort",sortable:"custom",width:"100"},null,8,["label"]),n(x,{label:e.$t("无限权限"),align:"center",prop:"ignorePermissionControl",sortable:"custom",width:"100"},{default:d((({row:e})=>[n(B,{modelValue:e.ignorePermissionControl,"onUpdate:modelValue":t=>e.ignorePermissionControl=t,onChange:t=>v.changeIgnorePermissionControl(t,e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1},8,["label"]),n(Y,{label:e.$t("数据范围"),options:Object.entries(this.$GLOBAL.enums.dataScopes).map((e=>({value:e[0],text:e[1][1],type:e[1][2],pulse:"true"===e[1][3]}))),align:"center",prop:"dataScope",sortable:"custom",width:"120"},null,8,["label","options"]),n(x,{label:e.$t("显示仪表板"),align:"center",prop:"displayDashboard",sortable:"custom",width:"120"},{default:d((({row:e})=>[n(B,{modelValue:e.displayDashboard,"onUpdate:modelValue":t=>e.displayDashboard=t,onChange:t=>v.changeDisplayDashboard(t,e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1},8,["label"]),n(x,{label:e.$t("启用"),align:"center",prop:"enabled",sortable:"custom",width:"100"},{default:d((({row:e})=>[n(B,{modelValue:e.enabled,"onUpdate:modelValue":t=>e.enabled=t,onChange:t=>v.changeEnabled(t,e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1},8,["label"]),n(L,{buttons:v.naColOperation.buttons.concat({icon:"el-icon-document-copy",confirm:!0,title:"复制角色",click:v.copyRole},v.naColOperation.delButton("删除角色",e.$API.sys_role.delete)),vue:this,width:"200"},null,8,["buttons"])])),_:1},8,["export-api","params","query-api","onDataChange"])])),_:1})])),_:1}),g.dialog.save?(i(),c(M,{key:0,onClosed:t[4]||(t[4]=e=>g.dialog.save=null),onMounted:t[5]||(t[5]=t=>e.$refs.saveDialog.open(g.dialog.save)),onSuccess:t[6]||(t[6]=(t,s)=>v.table.handleUpdate(e.$refs.table,t,s)),ref:"saveDialog"},null,512)):b("",!0)],64)}]]);export{C as default};
