import e from"./commonPage-BVcOLrMC.js";import{s as t,n as s}from"./index--flfWqgW.js";import{n as o,p as r}from"./naFormPhone-1s2mVkIt.js";import{J as l,K as a,aj as i,o as m,S as d,a8 as p,a as n,Q as u,P as c,O as f,c as h}from"./@vue-_BCsYqm-.js";import{_ as g}from"./index-C3Re8InM.js";import"./logo-BrD2dTrf.js";import"./element-plus-CoQd9HEf.js";import"./lodash-es-DCh--ulG.js";import"./@vueuse-DKZ1O7gq.js";import"./@element-plus-DpD46RjY.js";import"./@sxzz-CpAfbxx4.js";import"./@ctrl-D2oWfImC.js";import"./dayjs-Cud5yAXI.js";import"./async-validator-BTKOuuO-.js";import"./memoize-one-Ds0C_khL.js";import"./normalize-wheel-es-Vn5vHDCm.js";import"./@floating-ui-DT7V1Oc1.js";import"./crypto-js-BfYQ37JU.js";import"./axios-DMXdiZgf.js";import"./vue-router-CJBOlWwF.js";import"./nprogress-BX4rmQ7W.js";import"./vuex-CNGLPxA3.js";import"./json-bigint-D0bu8vFr.js";import"./bignumber.js-iDjSUVmj.js";import"./vue-i18n-DbMEmpqT.js";import"./@intlify-CZIS8eQd.js";import"./vue3-json-viewer-B-aZDOpp.js";import"./ace-builds-D9YH2WY7.js";import"./vue3-ace-editor-ubj-WOyx.js";import"./resize-observer-polyfill-CzGuHLZU.js";import"./sortablejs-BALiOaUQ.js";import"./vkbeautify-DEVEMlla.js";const v={class:"el-form-item-msg"},y={key:2};const j=g({components:{commonPage:e,naFormPhone:o,scPasswordStrength:t},data(){return{loading:!1,stepActive:0,showAgree:!1,form:{agree:!1,passwordText2:"",passwordText:"",userName:"",verifySmsCodeReq:{}},rules:{agree:[{validator:(e,t,s)=>{t?s():s(new Error(this.$t("请阅读并同意协议")))}}],passwordText2:s.passwordText2((()=>this.form.passwordText)),passwordText:s.passwordText(this),userName:[{required:!0,message:this.$t("请输入用户名")},{validator:async(e,t,s)=>{try{return(await this.$API.sys_user.checkUserNameAvailable.post({userName:t,id:this.form.id})).data?s():s(new Error(this.$t("用户名已被使用")))}catch(o){return s(new Error(o.data.msg.userName[0].children))}},trigger:"blur"}],verifySmsCodeReq:{destDevice:[r.mobile(this),r.mobileNoUsed(this,(()=>this.form.id))],code:r.code(this)}}}},async mounted(){},methods:{pre(){this.stepActive-=1},async next(){if(!(await this.$refs[`stepForm_${this.stepActive}`].validate().catch((()=>{}))))return!1;this.stepActive+=1},async save(){if(!(await this.$refs[`stepForm_${this.stepActive}`].validate().catch((()=>{}))))return!1;this.loading=!0;try{await this.$API.sys_user.register.post(this.form),this.stepActive+=2}catch{}this.loading=!1},goLogin(){this.$router.push({path:"/guest/login"})}}},[["render",function(e,t,s,o,r,g){const j=i("el-step"),w=i("el-steps"),$=i("el-input"),x=i("el-form-item"),b=i("scPasswordStrength"),_=i("el-checkbox"),A=i("el-form"),k=i("na-form-phone"),V=i("el-button"),C=i("el-result"),T=i("el-dialog"),z=i("common-page");return m(),l(z,{title:e.$t("注册新账号")},{default:a((()=>[d(w,{active:r.stepActive,"finish-status":"success",simple:""},{default:a((()=>[d(j,{title:e.$t("填写账号")},null,8,["title"]),d(j,{title:e.$t("验证手机")},null,8,["title"]),d(j,{title:e.$t("注册成功")},null,8,["title"])])),_:1},8,["active"]),0===r.stepActive?(m(),l(A,{key:0,model:r.form,rules:r.rules,onKeyup:p(g.next,["enter"]),"label-width":"15rem",ref:"stepForm_0",size:"large"},{default:a((()=>[d(x,{label:e.$t("登录账号"),prop:"userName"},{default:a((()=>[d($,{modelValue:r.form.userName,"onUpdate:modelValue":t[0]||(t[0]=e=>r.form.userName=e),placeholder:e.$t("请输入登录账号"),clearable:"",maxlength:"16"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),d(x,{label:e.$t("登录密码"),prop:"passwordText"},{default:a((()=>[d($,{modelValue:r.form.passwordText,"onUpdate:modelValue":t[1]||(t[1]=e=>r.form.passwordText=e),placeholder:e.$t("请输入登录密码"),clearable:"",maxlength:"16","show-password":"",type:"password"},null,8,["modelValue","placeholder"]),d(b,{modelValue:r.form.passwordText,"onUpdate:modelValue":t[2]||(t[2]=e=>r.form.passwordText=e)},null,8,["modelValue"]),n("div",v,u(e.$t("请输入包含英文、数字的8位以上密码")),1)])),_:1},8,["label"]),d(x,{label:e.$t("确认密码"),prop:"passwordText2"},{default:a((()=>[d($,{modelValue:r.form.passwordText2,"onUpdate:modelValue":t[3]||(t[3]=e=>r.form.passwordText2=e),placeholder:e.$t("请再一次输入登录密码"),clearable:"",maxlength:"16","show-password":"",type:"password"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),d(x,{label:"",prop:"agree"},{default:a((()=>[d(_,{modelValue:r.form.agree,"onUpdate:modelValue":t[4]||(t[4]=e=>r.form.agree=e),label:""},{default:a((()=>[c(u(e.$t("我已阅读并同意")),1)])),_:1},8,["modelValue"]),n("span",{onClick:t[5]||(t[5]=e=>r.showAgree=!0),class:"link"},"《"+u(e.$t("平台服务协议"))+"》",1)])),_:1})])),_:1},8,["model","rules","onKeyup"])):f("",!0),1===r.stepActive?(m(),l(A,{key:1,model:r.form,rules:r.rules,ref:"stepForm_1",size:"large"},{default:a((()=>[d(k,{modelValue:r.form.verifySmsCodeReq,"onUpdate:modelValue":t[6]||(t[6]=e=>r.form.verifySmsCodeReq=e),"code-field":["verifySmsCodeReq.code","code"],"phone-field":["verifySmsCodeReq.destDevice","destDevice"],"phone-place-holder":e.$t("手机号码"),vue:this,"form-name":"stepForm_1"},null,8,["modelValue","phone-place-holder"])])),_:1},8,["model","rules"])):f("",!0),r.stepActive>=2?(m(),h("div",y,[d(C,{"sub-title":e.$t("可以使用登录账号以及手机号登录系统"),title:e.$t("注册成功"),icon:"success"},{extra:a((()=>[d(V,{onClick:g.goLogin,size:"large",type:"primary"},{default:a((()=>[c(u(e.$t("前去登录")),1)])),_:1},8,["onClick"])])),_:1},8,["sub-title","title"])])):f("",!0),d(A,{size:"large",style:{"text-align":"center"}},{default:a((()=>[r.stepActive>0&&r.stepActive<2?(m(),l(V,{key:0,onClick:g.pre,size:"large"},{default:a((()=>[c(u(e.$t("上一步")),1)])),_:1},8,["onClick"])):f("",!0),r.stepActive<1?(m(),l(V,{key:1,onClick:g.next,size:"large",type:"primary"},{default:a((()=>[c(u(e.$t("下一步")),1)])),_:1},8,["onClick"])):f("",!0),1===r.stepActive?(m(),l(V,{key:2,loading:r.loading,onClick:g.save,size:"large",type:"primary"},{default:a((()=>[c(u(e.$t("提交")),1)])),_:1},8,["loading","onClick"])):f("",!0)])),_:1}),d(T,{modelValue:r.showAgree,"onUpdate:modelValue":t[9]||(t[9]=e=>r.showAgree=e),title:e.$t("平台服务协议"),"destroy-on-close":""},{footer:a((()=>[d(V,{onClick:t[7]||(t[7]=e=>r.showAgree=!1)},{default:a((()=>[c(u(e.$t("取消")),1)])),_:1}),d(V,{onClick:t[8]||(t[8]=()=>{r.showAgree=!1,r.form.agree=!0}),type:"primary"},{default:a((()=>[c(u(e.$t("我已阅读并同意")),1)])),_:1})])),_:1},8,["modelValue","title"])])),_:1},8,["title"])}]]);export{j as default};
