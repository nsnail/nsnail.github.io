const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-vK34s0DD.js","./index-C3Re8InM.js","./@vue-_BCsYqm-.js","./element-plus-CoQd9HEf.js","./lodash-es-DCh--ulG.js","./@vueuse-DKZ1O7gq.js","./@element-plus-DpD46RjY.js","./@sxzz-CpAfbxx4.js","./@ctrl-D2oWfImC.js","./dayjs-Cud5yAXI.js","./async-validator-BTKOuuO-.js","./memoize-one-Ds0C_khL.js","./normalize-wheel-es-Vn5vHDCm.js","./@floating-ui-DT7V1Oc1.js","../css/element-plus-B3lJtvYm.css","./crypto-js-BfYQ37JU.js","./axios-DMXdiZgf.js","./vue-router-CJBOlWwF.js","./nprogress-BX4rmQ7W.js","../css/nprogress-BgDCIyLK.css","./vuex-CNGLPxA3.js","./json-bigint-D0bu8vFr.js","./bignumber.js-iDjSUVmj.js","./vue-i18n-DbMEmpqT.js","./@intlify-CZIS8eQd.js","./vue3-json-viewer-B-aZDOpp.js","../css/vue3-json-viewer-ByH33Jf7.css","./ace-builds-D9YH2WY7.js","./vue3-ace-editor-ubj-WOyx.js","./resize-observer-polyfill-CzGuHLZU.js","./sortablejs-BALiOaUQ.js","./vkbeautify-DEVEMlla.js","../css/index-CllpfDYF.css","../css/index-NxIOSn44.css"])))=>i.map(i=>d[i]);
import{_ as e,D as a,a as t}from"./index-C3Re8InM.js";import{aj as l,at as s,o,J as i,K as d,S as r,P as m,Q as n,O as u,L as p,c as b,a as h,R as f,a7 as c,T as y,aE as $}from"./@vue-_BCsYqm-.js";import{v as g}from"./vkbeautify-DEVEMlla.js";import"./element-plus-CoQd9HEf.js";import"./lodash-es-DCh--ulG.js";import"./@vueuse-DKZ1O7gq.js";import"./@element-plus-DpD46RjY.js";import"./@sxzz-CpAfbxx4.js";import"./@ctrl-D2oWfImC.js";import"./dayjs-Cud5yAXI.js";import"./async-validator-BTKOuuO-.js";import"./memoize-one-Ds0C_khL.js";import"./normalize-wheel-es-Vn5vHDCm.js";import"./@floating-ui-DT7V1Oc1.js";import"./crypto-js-BfYQ37JU.js";import"./axios-DMXdiZgf.js";import"./vue-router-CJBOlWwF.js";import"./nprogress-BX4rmQ7W.js";import"./vuex-CNGLPxA3.js";import"./json-bigint-D0bu8vFr.js";import"./bignumber.js-iDjSUVmj.js";import"./vue-i18n-DbMEmpqT.js";import"./@intlify-CZIS8eQd.js";import"./vue3-json-viewer-B-aZDOpp.js";import"./ace-builds-D9YH2WY7.js";import"./vue3-ace-editor-ubj-WOyx.js";import"./resize-observer-polyfill-CzGuHLZU.js";import"./sortablejs-BALiOaUQ.js";const _=$((()=>t((()=>import("./index-vK34s0DD.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33]),import.meta.url))),j={class:"treeMain"},v={class:"treeMain"},w={class:"treeMain",style:{width:"100%"}};const V=e({components:{User:_},created(){},data(){return{form:{displayDashboard:!1,dashboardLayout:this.jsonFormat(a.APP_SET_HOME_GRID),sort:100,enabled:!0},loading:!0,mode:"add",rules:{sort:[{required:!0,message:"请输入排序",trigger:"change"}],name:[{required:!0,message:"请输入角色名称"}]},tabId:"0",titleMap:{add:this.$t("新增角色"),edit:this.$t("编辑角色"),view:this.$t("查看角色")},trees:{menu:[],api:[],dept:[]},visible:!1}},emits:["success","closed","mounted"],methods:{jsonFormat(e){try{e=g.json(e,2)}catch{this.$message.error(this.$t("非JSON格式"))}return e},async getTrees(e){const a=await this.$API[`sys_${e}`].query.post();this.trees[e]=a.data,await this.$nextTick(),await this.$refs[e].setCheckedKeys((this.form[`${e}Ids`]||[]).filter((a=>this.$refs[e].getNode(a).isLeaf)),!0)},async open(e){var a;if(this.visible=!0,this.loading=!0,this.mode=e.mode,null==(a=e.row)?void 0:a.id){const a=await this.$API.sys_role.get.post({id:e.row.id});Object.assign(this.form,a.data)}return await this.getTrees("menu"),await this.getTrees("api"),await this.getTrees("dept"),this.loading=!1,e.tabId&&(this.tabId=e.tabId),this},async submit(){if(!(await this.$refs.dialogForm.validate().catch((()=>{}))))return!1;this.loading=!0;const e=Object.assign({},this.form,{deptIds:this.$refs.dept.getCheckedKeys().concat(this.$refs.dept.getHalfCheckedKeys()),menuIds:this.$refs.menu.getCheckedKeys().concat(this.$refs.menu.getHalfCheckedKeys()),apiIds:this.$refs.api.getCheckedKeys().concat(this.$refs.api.getHalfCheckedKeys())}),a="add"===this.mode?this.$API.sys_role.create:this.$API.sys_role.edit;try{const t=await a.post(e);this.$emit("success",t.data,this.mode),this.visible=!1,this.$message.success(this.$t("操作成功"))}catch{}this.loading=!1}},mounted(){this.$emit("mounted")}},[["render",function(e,a,t,$,g,_){var V;const k=l("el-input"),I=l("el-form-item"),P=l("el-input-number"),C=l("el-switch"),x=l("el-form"),A=l("el-tab-pane"),D=l("el-tree"),O=l("el-radio-button"),T=l("el-radio-group"),K=l("VAceEditor"),L=l("el-button"),S=l("user"),E=l("JsonViewer"),U=l("el-tabs"),F=l("scDialog"),R=s("loading");return o(),i(F,{modelValue:g.visible,"onUpdate:modelValue":a[11]||(a[11]=e=>g.visible=e),title:`${g.titleMap[g.mode]}：${(null==(V=g.form)?void 0:V.id)??"..."}`,onClosed:a[12]||(a[12]=a=>e.$emit("closed")),"destroy-on-close":"","full-screen":""},{footer:d((()=>[r(L,{onClick:a[10]||(a[10]=e=>g.visible=!1)},{default:d((()=>[m(n(e.$t("取消")),1)])),_:1}),"view"!==g.mode?(o(),i(L,{key:0,disabled:g.loading,loading:g.loading,onClick:_.submit,type:"primary"},{default:d((()=>[m(n(e.$t("保存")),1)])),_:1},8,["disabled","loading","onClick"])):u("",!0)])),default:d((()=>[p((o(),b("div",null,[r(U,{modelValue:g.tabId,"onUpdate:modelValue":a[9]||(a[9]=e=>g.tabId=e),"tab-position":"top"},{default:d((()=>[r(A,{label:e.$t("基本信息")},{default:d((()=>[r(x,{disabled:"view"===g.mode,model:g.form,rules:g.rules,"label-width":"15rem",ref:"dialogForm"},{default:d((()=>[r(I,{label:e.$t("角色名称"),prop:"name"},{default:d((()=>[r(k,{modelValue:g.form.name,"onUpdate:modelValue":a[0]||(a[0]=e=>g.form.name=e),clearable:""},null,8,["modelValue"])])),_:1},8,["label"]),r(I,{label:e.$t("排序"),prop:"sort"},{default:d((()=>[r(P,{modelValue:g.form.sort,"onUpdate:modelValue":a[1]||(a[1]=e=>g.form.sort=e),min:0,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])])),_:1},8,["label"]),r(I,{label:e.$t("启用"),prop:"enabled"},{default:d((()=>[r(C,{modelValue:g.form.enabled,"onUpdate:modelValue":a[2]||(a[2]=e=>g.form.enabled=e)},null,8,["modelValue"])])),_:1},8,["label"]),r(I,{label:e.$t("无限权限"),prop:"ignorePermissionControl"},{default:d((()=>[r(C,{modelValue:g.form.ignorePermissionControl,"onUpdate:modelValue":a[3]||(a[3]=e=>g.form.ignorePermissionControl=e)},null,8,["modelValue"])])),_:1},8,["label"]),r(I,{label:e.$t("备注"),prop:"summary"},{default:d((()=>[r(k,{modelValue:g.form.summary,"onUpdate:modelValue":a[4]||(a[4]=e=>g.form.summary=e),clearable:"",type:"textarea"},null,8,["modelValue"])])),_:1},8,["label"])])),_:1},8,["disabled","model","rules"])])),_:1},8,["label"]),r(A,{label:e.$t("菜单权限")},{default:d((()=>[h("div",j,[r(D,{data:g.trees.menu,props:{label:e=>e.meta.title},"default-expand-all":"","node-key":"id",ref:"menu","show-checkbox":""},null,8,["data","props"])])])),_:1},8,["label"]),r(A,{label:e.$t("接口权限")},{default:d((()=>[h("div",v,[r(D,{data:g.trees.api,props:{label:e=>`${e.summary} - ${e.id}`},"default-expand-all":"","node-key":"id",ref:"api","show-checkbox":""},null,8,["data","props"])])])),_:1},8,["label"]),r(A,{label:e.$t("数据权限")},{default:d((()=>[r(x,{"label-width":"10rem"},{default:d((()=>[r(I,{label:e.$t("数据权限")},{default:d((()=>[r(T,{modelValue:g.form.dataScope,"onUpdate:modelValue":a[5]||(a[5]=e=>g.form.dataScope=e),disabled:"view"===g.mode},{default:d((()=>[(o(!0),b(f,null,c(this.$GLOBAL.enums.dataScopes,((e,a)=>(o(),i(O,{key:a,label:e[1],value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"])])),_:1},8,["label"]),p(r(I,{label:e.$t("选择部门")},{default:d((()=>[h("div",w,[r(D,{data:g.trees.dept,props:{label:e=>e.name},"default-expand-all":"","node-key":"id",ref:"dept","show-checkbox":""},null,8,["data","props"])])])),_:1},8,["label"]),[[y,"specificDept"===g.form.dataScope]]),r(I,{label:e.$t("首页视图")},{default:d((()=>[r(T,{modelValue:g.form.displayDashboard,"onUpdate:modelValue":a[6]||(a[6]=e=>g.form.displayDashboard=e),disabled:"view"===g.mode},{default:d((()=>[r(O,{label:e.$t("仪表板"),value:!0},null,8,["label"]),r(O,{label:e.$t("工作台"),value:!1},null,8,["label"])])),_:1},8,["modelValue","disabled"])])),_:1},8,["label"]),g.form.displayDashboard?(o(),i(I,{key:0,label:e.$t("仪表板布局")},{default:d((()=>[r(K,{value:g.form.dashboardLayout,"onUpdate:value":a[7]||(a[7]=e=>g.form.dashboardLayout=e),theme:this.$TOOL.data.get("APP_SET_DARK")||this.$CONFIG.APP_SET_DARK?"github_dark":"github",lang:"json",style:{height:"30rem",width:"100%"}},null,8,["value","theme"]),r(L,{onClick:a[8]||(a[8]=e=>g.form.dashboardLayout=_.jsonFormat(g.form.dashboardLayout)),link:"",type:"primary"},{default:d((()=>[m(n(e.$t("JSON 格式化")),1)])),_:1})])),_:1},8,["label"])):u("",!0)])),_:1})])),_:1},8,["label"]),"view"===g.mode?(o(),i(A,{key:0,label:e.$t("用户列表"),name:"user"},{default:d((()=>["user"===g.tabId?(o(),i(S,{key:0,"role-id":g.form.id},null,8,["role-id"])):u("",!0)])),_:1},8,["label"])):u("",!0),"view"===g.mode?(o(),i(A,{key:1,label:e.$t("原始数据")},{default:d((()=>[r(E,{"expand-depth":5,theme:this.$TOOL.data.get("APP_SET_DARK")||this.$CONFIG.APP_SET_DARK?"dark":"light",value:g.form,copyable:"",expanded:"",sort:""},null,8,["theme","value"])])),_:1},8,["label"])):u("",!0)])),_:1},8,["modelValue"])])),[[R,g.loading]])])),_:1},8,["modelValue","title"])}]]);export{V as default};
